<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://mangpumo.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://mangpumo.github.io/atom.xml"><link rel="alternate" type="application/json" href="https://mangpumo.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="java,git,cas"><link rel="canonical" href="https://mangpumo.github.io/2022/11/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/"><title>计算机网络体系结构 | Mang Pumo = = 翩若浮云着霓裳，落幕鬓边皆染霜</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">计算机网络体系结构</h1><div class="meta"><span class="item" title="创建时间：2022-11-25 22:24:32"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-11-25T22:24:32+08:00">2022-11-25</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>31k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>28 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Mang Pumo</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclhfehz7j20zk0m8u0x.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciusoyjnj219g0u0x56.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciuja1j1j20zk0m8kjl.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipevgoki5j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclgrvbd6j20zk0m8qv5.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://mangpumo.github.io/2022/11/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Mang Pumo"><meta itemprop="description" content="翩若浮云着霓裳，落幕鬓边皆染霜, 欢迎来到 Mang Pumo 的个人博客!"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h1 id="计算机网络体系结构"><a class="anchor" href="#计算机网络体系结构">#</a> 计算机网络体系结构</h1><h2 id="21-常用的计算机网络体系结构"><a class="anchor" href="#21-常用的计算机网络体系结构">#</a> 2.1 常用的计算机网络体系结构</h2><h3 id="211-osi体系结构"><a class="anchor" href="#211-osi体系结构">#</a> 2.1.1 OSI 体系结构</h3><p>1、为了使不同体系结构的计算机网络都能够互联，国际标准化组织于 1977 年成立了专门机构研究该问题，不久他们就提出了一个试图使各种计算机在世界范围内都能够互连成网的标准框架，也就是著名的 “<strong>开放系统互连参考模型</strong>”，<strong>简称为 OSI，OSI 体系结构有时候我们也称之为 OSI 模型</strong>。</p><p>2、OSI 是一个<strong>七层协议</strong>的体系结构：从下往上依次是<strong>物理层、数据链路层、网络层、运输层、会话层、表示层、应用层</strong>。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b844f5a8acdb4f3ba77a8cb67eafff30.png" alt><br>3、OSI 试图达到一种理想境界，即全球计算机网络都遵循这个统一标准，因而全球的计算机将能够很方便地进行互连和交换数据。在 20 世纪 80 年代，许多大公司甚至一些国家的政府机构纷纷表示支持 OSI。当时看来似乎在不久的将来全世界一定会按照 OSI 制定的标准来构造自己的计算机网络。</p><p>4、然而到了 20 世纪 90 年代初期，虽然整套的 OSI 国际标准都已经制定出来了，但由于基于 TCP/IP 的互联网已抢先在全球相当大的范围成功地运行了，而与此同时却几乎找不到有什么厂家生产出符合 OSI 标准的商用产品。因此人们得出这样的结论：<strong>OSI 只获得了一些理论研究的成果，但在市场化方面则事与愿违地失败了</strong>。</p><p><strong>现今规模最大的、覆盖全球的、基于 TCP/IP 的互联网并未使用 OSI 标准。</strong></p><p>5、OSI 失败的原因可归纳为:</p><ul><li>OSI 的专家们缺乏实际经验，他们在完成 OSI 标准时缺乏商业驱动力；</li><li>OSI 的协议实现起来过分复杂，而且运行效率很低；</li><li>OSI 标准的制定周期太长，因而使得按 OSI 标准生产的设备无法及时进入市场；</li><li>OSI 的层次划分不太合理，有些功能在多个层次中重复出现。<br>6.<strong>OSI 体系结构是法律上的国际标准， TCP/IP 体系结构是事实上的国际标准</strong></li></ul><h3 id="212具有五层协议的体系结构"><a class="anchor" href="#212具有五层协议的体系结构">#</a> 2.1.2 具有五层协议的体系结构</h3><p>1.TCP/IP 是一个<strong>四层</strong>的体系结构，它包含<strong>应用层、运输层、网际层和网络接口层</strong>（用网际层这个名字是强调这一层是为了解决不同网络的互连问题)。</p><p>2、OSI 的七层协议体系结构概念清楚，理论也比较完整，但是太过于复杂不实用。TCP/IP 体系结构不同，但是现在却得到了非常广泛的应用。</p><p>3、在学习计算机网络的原理时往往采取折中的办法，即综合 OSI 和 TCP/IP 的优点，<strong>采用一种只有五层协议的体系结构</strong>，这样既简洁又能将概念阐述清楚。有时为了方便，也可把最底下两层称为<strong>网络接口层</strong>。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e2756b4c1b244b9d862e1eba6e4e80ef.png" alt></p><p>4、下面我们结合互联网的情况，自上而下地，非常简要的介绍一下各层的主要功能。</p><ul><li><p><strong>应用层（application layer）</strong></p><ul><li>应用层是体系结构中的最高层。应用层的任务是通过应用进程间的交互来完成特定网络应用。应用层协议定义的是应用进程间通信和交互的规则。这里的进程就是指主机中正在运行的程序。对于<strong>不同的网络应用需要有不同的应用层协议</strong>。在互联网中的应用层协议很多，如<strong>域名系统 DNS，支持万维网应用的 HTTP 协议，支持电子邮件的 SMTP 协议</strong>，等等。<strong>我们把应用层交互的数据单元称为报文 (message)</strong>。</li></ul></li><li><p><strong>运输层（transport layer）</strong></p><ul><li>运输层的任务就是负责<strong>向两台主机中进程之间的通信提供通用的数据传输服务</strong>。</li><li>运输层主要使用以下两种协议:<ul><li><strong>传输控制协议 TCP (Transmission Control Protocol)</strong>：提供面向连接的、可靠的数据传输服务</li><li><strong>用户数据报协议 UDP (User Datagram Protocol）</strong>：提供无连接的、尽最大努力 (best-effort) 的数据传输服务（不保证数据传输的可靠性)</li></ul></li><li>TCP 和 UDP 协议都有固定的格式，数据在经过运输层时会根据所选择的运输协议在应用层传递过来的数据基础上加上对应协议的头部。</li></ul></li><li><p><strong>网络层（network layer）</strong></p><ul><li>主要作用是实现<strong>两个网络系统之间的数据透明传送</strong>，具体包括<strong>路由选择</strong>，<strong>拥塞控制</strong>和<strong>网际互连</strong>等。</li><li>在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包进行传送。在 TCP/IP 体系中，由于网络层使用 IP 协议，因此分组也叫做<strong> IP 数据报</strong>，简称为<strong>数据报</strong>。</li><li>数据在经过网络层时会加上 IP 协议的头部</li></ul></li><li><p><strong>数据链路层（data link layer）</strong></p><ul><li>利用传输介质为数据链路层提供物理连接，实现比特流的透明传输。</li><li><strong>物理层上所传输数据的单位是比特。</strong></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/1b32f919f9a245369e56542ac6c89cae.png" alt></p></li></ul><h2 id="22-物理层"><a class="anchor" href="#22-物理层">#</a> 2.2 物理层</h2><h3 id="221-物理层的基本概念"><a class="anchor" href="#221-物理层的基本概念">#</a> 2.2.1 物理层的基本概念</h3><p>1、物理层主要解决在各种传输媒体上传输比特 0 和 1 的问题，进而给数据链路层提供透明传输比特流的服务</p><p>2、由于传输媒体的种类太多（例如<strong>同轴电缆、光纤、无线电波</strong>等），物理连接方式也有很多例如<strong>点对点连接、广播连接</strong>等，因此物理层协议种类也比较多。但是物理层为了解决在各种传输媒体上传输比特 0 和 1 的问题，无论是那种物理层协议都需要满足主以下四个任务：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/691eefef65b04a50af678f33529edda3.png" alt></p><h3 id="222-传输媒体"><a class="anchor" href="#222-传输媒体">#</a> 2.2.2 传输媒体</h3><p>1、导引型传输媒体：电磁波被导引沿着固体媒体传播</p><ul><li><strong>同轴电缆</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/9c5b4fac605c4b8c869bd18b4302497f.png" alt><ul><li>以从上图看出同轴电缆的各层都是共圆心的，也就是同轴心的</li><li>同轴电缆有两种<ul><li><strong>基带同轴电缆</strong>：数字传输，过去用于局域网</li><li><strong>宽带同轴电缆</strong>：模拟传输，目前主要用于有线电视</li></ul></li><li>同轴电缆价格较贵且布线不够灵活和方便，随着集线器的出现，在局域网领域基本上都是采用双绞线作为传输媒体</li></ul></li><li><strong>双绞线</strong><ul><li><strong>双绞线是最常用的传输媒体</strong>，把两根互相绝缘的铜导线放在一起，然后按照一定规则绞合起来就构成了双绞线。</li><li>常用的双绞线包含<strong>八根铜导线</strong>，每两根绞合成一条双绞线，绞合组合如下：<ul><li>蓝色线和蓝白双色线绞合</li><li>橙色线和橙白双色线绞合</li><li>绿色线和绿白双色线绞合</li><li>棕色线和棕白双色线绞合</li></ul></li><li>绞合的作用：<ul><li>抵御部分来自外界的电磁干扰</li><li>减少相邻导线的电磁干扰</li></ul></li><li>根据有无屏蔽层，双绞线分为：<strong>无屏蔽双绞线</strong>和<strong>屏蔽双绞线</strong><ul><li>无屏蔽<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ff9dba22158c4bc785a587d5219d4191.png" alt></li><li>屏蔽双绞线：在双绞线与外层绝缘封套之间有一个<strong>金属屏蔽层</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4246f54fcba640798a92a4a76a727ab5.png" alt></li></ul></li><li>常用的绞合线类别、带宽及典型应用<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2750e276192c407584373703beb5f0c0.png" alt></li></ul></li><li><strong>光纤</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/94132b8f5e5f4fcf86a141a888731198.png" alt><ul><li>光纤的优点<ul><li>通信容量大 (25000~30000GHz 的带宽)</li><li>传输损耗小，远距离传输时更加经济。</li><li>抗雷电和电磁干扰性能好。这在大电流脉冲干扰的环境下尤为重要。</li><li>无串音干扰，保密性好，不易被窃听。</li><li>体积小，重量轻。</li></ul></li></ul></li></ul><p>2、非导引型传输媒体：非导引型传输媒体是指自由空间</p><ul><li><strong>无线电波</strong></li><li><strong>微波</strong></li><li><strong>红外线</strong></li><li><strong>可见光</strong></li></ul><h2 id="23-数据链路层"><a class="anchor" href="#23-数据链路层">#</a> 2.3 数据链路层</h2><h3 id="231-数据链路层概述"><a class="anchor" href="#231-数据链路层概述">#</a> 2.3.1 数据链路层概述</h3><p><strong>1、数据链路层在网络体系结构中所处的地位</strong><br>如下图所示：主机 H1 给主机 H2 发送数据，中间要经过三个路由器、电话网、局域网、广域网等多种网络。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/91fdba580fea42278cc5b83989260b4c.png" alt></p><p>从五层协议原理体系结构的角度来看，主机应该具有体系结构中的各个层次，而路由器只需要具有体系结构中的网络层、数据链路层、物理层。网络中的各个设备通过传输媒体进行互连，主机 H1 将需要发送的数据<strong>逐层封装</strong>后通过物理层将构成数据包的各个比特转换为电信号发送到传输媒体，数据包进入到路由器后，<strong>从下网上逐层解封到网络层</strong>，路由器根据数据包的<strong>目的网络地址</strong>和<strong>自身的转发表</strong>确定数据包的转发端口，然后从网络层向下逐层封装数据包，最后通过物理层将数据包发送到传输媒体，最后到达主机 H2，主机 H2 在接收到数据包后再逐层解封。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/23504ea18c834ebc8f510bbccc61243d.gif" alt></p><p>当我们研究数据链路层时，我们可以只关心数据链路层，而不考虑其他各层。我们可以想象，数据只在数据链路层从左至右沿水平方向传送。从数据链路层来看，主机 H1 到主机 H2 的通信可以看作是在 4 段不同的链路上的通信所组成的。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/8b5fe4d2c549488ebf4bf85df83edf95.gif" alt><br>所谓的<strong>链路 (Link) 就是从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点。要在链路上传输数据，仅有链路还不够，还需要一些通信协议来控制这些数据的传输，如果把实现这些协议的硬件和软件加到链路上就构成了数据链路</strong>（Data Link）</p><p>在数据链路上传输的数据包，又称为<strong>帧</strong>。（数据链路层是以帧作为单位传输和处理的）<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2d9c035a96f047dc8365d514662581be.png" alt><br><em><strong>注意：结点就是网络中的一台主机。</strong></em><br>数据链路层的协议有很多种，但是有三个基本问题是共同的。这三个基本问题就是：<strong>封装成帧、透明传输和差错检测</strong>。</p><h3 id="232-封装成帧"><a class="anchor" href="#232-封装成帧">#</a> 2.3.2 封装成帧</h3><p>封装成帧是指数据链路层给上层交付的协议数据单元添加<strong>帧头</strong>和<strong>帧尾</strong>使之成为帧。</p><ul><li><strong>帧头和帧尾中包含有重要的控制信息</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/3d3beb5089e24c3da336b85b25ede0fd.png" alt><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/6be3b1149ffa4640948b7803fa44e859.png" alt></li><li>帧头和帧尾的作用之一就是<strong>帧定界</strong><ul><li>例如：PPP 帧的第一个字节和最后一个字节就是帧定界，通过这两个字节就能够从物理层交付的比特流中提取出一个一个的帧。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/80f2954c7be444f2b82c9dc5dc4f91a1.png" alt></li></ul></li><li><strong>并不是每种数据链路层协议的帧都包含有帧定界标志</strong>，例如 MAC 帧在帧头和帧尾中是没有包含帧定界的标志的， 那么接收方是如何从物理层交付的比特流中提取出一个个的以太网帧的呢？<ul><li>第一步：数据链路层封装好 MAC 帧，将其交付给物理层</li><li>第二步：物理层在 MAC 帧的前面添加 8 字节的<strong>前导码</strong>，前导码的<strong>前 7 个字节</strong>为<strong>前同步码</strong>，其作用是使接收方的时钟同步，之后的 1 个字节为帧开始定界符，表明其后紧跟着的就是 MAC 帧。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/28087c89f5064d9eb5260ba32ccb9e47.png" alt></li></ul></li></ul><h3 id="233-透明传输"><a class="anchor" href="#233-透明传输">#</a> 2.3.3 透明传输</h3><p>1、透明传输是指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样。</p><ul><li>当数据帧中的数据是帧定界标志时，发送端的数据链路层该如何处理呢？<ul><li><strong>当物理链路提供的是面向字符的传输服务时（物理链路以字符为单位传输数据）：</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c117eb47d7c14ca092fa9700d055c0cb.png" alt><br>数据链路层在交付数据给物理层时，对帧进行扫描，首先扫描到 SOH，然后每扫描到一个 SOH 或者 EOT 就在前面加<strong>转义字符 ESC</strong>，直至扫描到最后一个 EOT，这种方式称之为：<strong>字节填充 (byte stuffing)<strong> 或</strong>字符填充 (character stuffing)</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/34569f396b4946b1be876697e73c7dc9.png" alt><br>接收端的数据链路层在将数据送往网络层之前删除插入的转义字符</li><li><strong>当物理链路提供的是面向比特的传输服务时（物理链路以比特为单位传输数据）：</strong></li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/22d90f1eb3d442a2a98d019e0f1bedc0.png" alt></li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/453f687f13da443c841af18a50812b65.png" alt><br>考研真题：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/f4d50abca05f4af99733104de0e69ac0.png" alt><br>2、为了提高帧的传输效率，应当使帧的数据部分的长度尽可能大些。</li></ul></li></ul><p>3、考虑到差错控制等多种因素，每一种数据链路层协议都规定了帧的数据部分的长度上限，即最大传送单元<strong> MTU (Maximum Transfer Unit)。</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4b711c41092649eb8e426d59fb178618.png" alt></p><h3 id="234-差错校验"><a class="anchor" href="#234-差错校验">#</a> 2.3.4 差错校验</h3><p>1、实际的通信链路都不是理想的，比特流在传输过程中由于受到各种干扰可能会产生差错: 1 可能会变成 0, 而 0 也可能变成 1。这称为<strong>比特差错</strong>，或者称为<strong>误码。</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/1d2c97131cc3466eab199bb965ce7aa8.gif" alt></p><p>2、一段时间内，传输错误的比特占所传输比特总数的比率称为<strong>误码率（Bit Error Rate）</strong></p><p>3、接收方是如何知道数据在传输的过程中出现差错了呢？使用<strong>差错检测码</strong>来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一。</p><p>4、在封装好的帧中利用若干个字节表示帧校验序列 FCS 字段。FCS :Frame Check Sequence (帧校验序列)。FCS 字段由一些差错校验算法计算得出，常用的校验算法为：<strong>循环冗余校验 CRC (Cyclic Redundancy Check)</strong>。</p><p>5、接收方在接收到数据后计算出一个 FCS，然后将计算得出的 FCS 与接收到的数据帧中的 FCS 进行比较。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ab8ac756b833450aac48e0ca272410b5.png" alt><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ab8ac756b833450aac48e0ca272410b5.png" alt></p><p>由于判断 FCS 是否正确只能检测出帧在传输过程中出现了差错，但并不能定位错误，因此<strong>无法纠正错误</strong>。接收方可以通过<strong>检错重传</strong>方式来纠正传输中的差错，或者仅仅是<strong>丢弃检测到差错的帧</strong>，这取决于数据链路层向其上层提供的是<strong>可靠传输服务</strong>还是<strong>不可靠传输服务</strong>。</p><h3 id="234-以太网"><a class="anchor" href="#234-以太网">#</a> 2.3.4 以太网</h3><p>1.<strong> 以太网概念</strong></p><ul><li><strong>以太网是一种计算机局域网技术</strong>。<strong>IEEE</strong>（电气与电子工程师协会：Institute of Electrical and Electronics Engineers）组织的<strong> IEEE 802.3 标准</strong>制定了以太网的技术标准，它规定了包括<strong>物理层的连线、电子信号和介质访问层协议</strong>的内容。<strong>以太网是应用最普遍的局域网技术</strong>，取代了其他局域网技术如令牌环、FDDI 和 ARCNET。</li><li>以太网是一种有线系统，最初使用<strong>同轴电缆</strong>进行数据传输，后来发展到使用双绞线和光纤并延续至今。</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b681fbc83c974dac8142a48b9d65b1a0.png" alt></li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/d7e76738da654a189c597d303f5ff6ef.png" alt></li></ul><p>2、<strong>以太网的两个标准</strong></p><ul><li>1980 年 9 月，<strong>DEC 公司</strong>、<strong>英特尔 (Intel) 公司</strong>和<strong>施乐公司</strong>联合提出了 10 Mbit/s 以太网规约的第一个版本<strong> DIX V1</strong> (DIX 是这三个公司名称的缩写)。</li><li>1982 年又修改为第二版规约（实际上也就是最后的版本)，即<strong> DIX Ethernet V2</strong>，成为世界上第一个局域网产品的规约。</li><li>1983 年，<strong>IEEE 802 委员会</strong>的<strong> 802.3 工作组</strong>制定了第一个 IEEE 的以太网标准<strong> IEEE 802.3</strong> [W-IEEE802.3]，数据率为<strong> 10 Mbit/s</strong>。以太网的两个标准 DIX Ethernet V2 与 IEEE 的 802.3 标准只有很小的差别，因此很多人也常把 802.3 局域网简称为 &quot;以太网&quot;。</li><li>IEEE 802 委员会的介绍（引用自《计算机网络 - 谢希仁》）<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2d7adb93d22c4f57ba9f34e4dc9a1ece.png" alt></li><li>IEEE 802.3 定义了以太网的<strong>物理层</strong>和<strong>数据链路层</strong>的介质访问控制部分，其中物理层由两个组件组成：<strong>线缆</strong>和<strong>设备</strong>，数据链路层可以分为两部分：<strong>逻辑链路控制（LLC）</strong>、<strong>介质访问控制（MAC）</strong>。</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c41ad929dadc4d92a26cf68a7a9d2139.png" alt></li><li>物理层<ul><li>线缆：以太网的通信线缆由最先的同轴电缆发展到今天的双绞线和光纤。<ul><li>双绞线两端配有<strong> RJ45</strong> 八针连接器，这种八针连接器用于在半双工和全双工模式下进行数据的发送和接收。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/5dc054651c1b4fadaecf8036d98ae5fa.png" alt></li><li>半双工模式：数据一次沿一个方向传输<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/dbb0aba241e54bbbb302b4e156101f41.gif" alt></li><li>全双工模式：数据沿两个方向传输，以太网的全双工模式可以通过使用一对双绞线实现<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/d13a6f9287b74a639a50fb86537d54aa.gif" alt></li><li>光纤线缆：光纤线缆使用<strong>玻璃光纤</strong>或<strong>塑料光纤</strong>作为光脉冲的传输通道来传输数据<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/14749298c181408bb285f5657971bcd4.png" alt></li><li>光纤电缆可以根据实际需求使用不同类型的连接器：<strong>SFP 连接器</strong>、<strong>SC 连接器</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/3922a682840d49ff825a8adee3adf9ea.png" alt></li></ul></li><li>设备：以太网设备由计算机、打印机等具有网络接口卡的设备所组成，常用的以太网设备有<strong>路由器</strong>、<strong>交换机</strong>、<strong>网桥</strong>，而工作在数据链路层上的设备为交换机、网桥，路由器工作在五层体系结构中的网络层。</li></ul></li><li>数据链路层<ul><li>逻辑链路控制 LLC：为网络层提供统一的接口以便数据在设备间传输。很多厂商生产的适配器上就仅装有 MAC 协议而没有 LLC 协议。</li><li>介质访问控制 MAC：使用分配给网络接口卡的硬件地址来标识特定的计算机或设备接口，通过这种方法来表示数据传输的源地址和目的地址。</li></ul></li></ul><h3 id="235-以太网的mac层"><a class="anchor" href="#235-以太网的mac层">#</a> 2.3.5 以太网的 MAC 层</h3><p><strong>1、MAC 层的硬件地址</strong></p><ul><li><strong>MAC 地址 （英语：Media Access Control Address）</strong> ，直译为<strong>媒体存取控制位址</strong> ，也称为<strong>局域网地址</strong> （LAN Address），<strong>MAC 位址</strong> ，<strong>以太网地址</strong> （Ethernet Address）或物理地址 （Physical Address），它是一个用来确认网络设备位置的位址。</li><li>IEEE 802 标准为局域网规定了一种<strong> 48 位（6 字节）的全球地址（一般简称为 “地址”）</strong>，<strong>这个地址会固化在适配器</strong>的<strong> ROM</strong> 中。</li><li>IEEE 的<strong>注册管理机构 RA <strong>负责向厂家分配地址字段的</strong>前三个字节 (即高位 24 位)</strong>。地址字段中的后三个字节 (即低位 24 位) 由<strong>厂家自行指派</strong>，称为<strong>扩展标识符</strong>，必须保证生产出的适配器没有重复地址。世界上凡要生产局域网适配器的厂家都必须向 IEEE 购买由这三个字节构成的这个号（即地址块)，这个号的正式名称是组织唯一标识符。<ul><li>例如，3Com 公司生产的适配器的 MAC 地址的前三个字节是 02-60-8C。地址字段中的后三个字节（即低位 24 位）则由厂家自行指派，只要保证生产出的适配器没有重复地址即可</li></ul></li><li>一个地址块可以生成<strong> 2^24</strong> 个（二百八十多万亿个）不同的地址。这种 48 位地址称为<strong> MAC-48</strong>，它的通用名称是<strong> EUI-48</strong>。</li><li>一般情况下，用户主机会包含两个网络适配器：<strong>有线局域网适配器（有线网卡）和无线局域网适配器（无线网卡)</strong>。每个网络适配器都有一个全球唯一的 MAC 地址。而<strong>交换机和路由器往往拥有更多的网络接口</strong>，<strong>所以会拥有更多的 MAC 地址</strong>。综上所述，严格来说，MAC 地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。</li><li>我们可以在<strong> DOS 窗口</strong>输入命令：**ipconfig /all **， 查看本机网卡的 MAC 地址。</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/74c99c8537b349f7b640dba5955d2c3d.png" alt></li></ul><p><strong>2、MAC 地址的格式</strong></p><ul><li>MAC 地址的表示方法</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/3e0b09b0f2734ede8248842253c75be8.png" alt></li><li>MAC 地址的含义</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/8c5afaae80d24a2b9130a2440cc80e8d.png" alt></li></ul><p><strong>3、MAC 帧的格式</strong></p><p>数据链路层在网络层交付的 IP 数据包前面加上 **“目的地址”、“源地址”、“类型”<strong> 字段，并且在最后加入</strong> 4 字节的 FCS 字段 **，组成一个<strong>以太网 MAC 帧</strong>，然后再交付给物理层</p><ul><li>目的地址：接收主机的 MAC 地址</li><li>源地址：发送主机的 MAC 地址</li><li>类型：类型字段标志上一层使用的是什么<strong>协议</strong>，以便把收到的 MAC 帧的数据上交给上一层的这个协议。</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4c9bb345081742f0b323ede915fd81db.png" alt><br><em>注意：当数据字段的长度小于 46 字节时，应在数据字段的后面加入整数字节的填充字段，以保证以太网的 MAC 帧长不小于 64 字节。</em></li></ul><p><strong>4、MAC 地址的识别</strong><br>当多个主机连接到同一个广播信道上，要实现两个主机之间的通信，每个主机发送的帧中包含了目的地址和源地址，广播信道上的每一台主机都能够收到该帧，接收到帧的主机将帧中的目的地址与保存在网络适配器的电可擦除可编程只读存储器 EEPROOM 中的 MAC 地址进行比较，如果匹配则接受该帧，否则就丢弃该帧。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/acca62e431994803bf8a385783927a40.gif" alt></p><p>根据 MAC 地址为单播 MAC 地址还是广播 MAC 地址还是多播 MAC 地址，在计算机网络中 “<strong>发往本站（本主机）的帧</strong>” 分为三种：<strong>单播 (unicast) 帧（一对一）</strong>、<strong>广播 (broadcast) 帧（一对全体）</strong>、<strong>多播 (multicast) 帧（一对多）</strong>。</p><ul><li><strong>单播 MAC 地址</strong></li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c021328943174d60bb7a810fb2507654.gif" alt></li><li><strong>广播 MAC 地址</strong></li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/454f6a4545d14d129dc0c1aeb6d538f1.gif" alt></li><li><strong>多播 MAC 地址</strong></li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/80e9ab14efee4497bd47a5f67d0de5e9.png" alt></li><li><strong>随机 MAC 地址：</strong><br>据斯诺登介绍，美国国家安全局有一套系统通过监视电子设备的 MAC 地址来跟踪城市中每个人的行动，因此苹果率先在<strong> ios</strong> 系列设备扫描网络时采用随机 MAC 地址技术，随后<strong> Windows10</strong>，<strong>安卓 6.0 以及内核版本 3.18 的 Linux</strong> 系统也提供随机 MAC 地址功能。 目前大多数移动设备都采用了随机 MAC 地址技术。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/5bea4a4bcec747c085b2f71538bab2c5.png" alt></li></ul><h3 id="以太网交换机"><a class="anchor" href="#以太网交换机">#</a> 以太网交换机</h3><p><strong>1、以太网交换机的基本功能</strong></p><ul><li>以太网交换机是基于<strong>以太网传输数据</strong>的交换机，以太网交换机通常都有多个接口，每个接口都可以直接与一台主机或另一个以太网交换机相连，一般都工作在<strong>全双工方式</strong>。</li><li>以太网交换机具有并行性，能同时连通多对接口，使多对主机能同时通信。</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/6270e1455ff44ad78ceeab545ee4c25c.png" alt></li><li><strong>以太网交换机工作在数据链路层（也包括物理层)</strong>，它收到帧后，在帧交换表中查找帧的目的 MAC 地址所对应的接口号，然后通过该接口转发帧。</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/83e4adf17560421a8ece390f97488cae.gif" alt></li><li>帧的两种转发方式：<ul><li>存储转发：交换机在转发之前必须<strong>接收整个帧</strong>，并进行<strong>错误校检</strong>，如无错误再将这一帧发往目的地址。帧通过交换机的转发时延随帧长度的不同而变化。</li><li>直接交换：采用基于硬件的<strong>交叉矩阵</strong>（交换机只要检查到帧头中所包含的目的地址就立即转发该帧，而无需等待帧全部的被接收，也不进行错误校验。由于以太网帧头的长度总是固定的，因此帧通过交换机的转发时延也保持不变。）</li></ul></li><li>以太网交换机是一种即插即用设备，其内部的<strong>帧交换表</strong>是通过<strong>自学习算法</strong>自动的逐渐建立起来的。<br><strong>2、以太网交换机自学习和转发帧的流程</strong><br>刚上电时以太网交换机内部的帧交换表是空的，随着网络中各主机间的通信，通过<strong>自学习算法</strong>自动的逐渐建立起来<strong>帧交换表</strong>。</li></ul><p>如下图所示相互连接的 “以太网交换机 1” 和 “以太网交换机 2” 各自连接了三台主机，构成了一个交换式以太网。为了简单起见各台主机的 MAC 地址我们用一个大写字母表示，并且假设各台主机知道网络中其他各主机的 MAC 地址。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4d214d084357421fb3715f41cee0e73a.png" alt></p><p>下面我们来了解以太网交换机是如何进行自学习和转发帧的：</p><ul><li>主机 A 发送数据给主机 B<ul><li>该帧从交换机 1 的接口 1 进入交换机，交换机 1 首先进行登记工作，将该帧中的源 MAC 地址 A 记录到自己的帧交换表中，并且将接口号 1 与 MAC 地址 A 相对应也记录到帧交换表中。以上的登记工作就称之为交换机的自学习。</li><li>交换机 1 对该帧进行转发，该帧中的目的 MAC 地址是 B，在帧交换表中查找 MAC 地址 B，发现找不到就对该帧进行盲目地转发（也成为泛洪），也就说会将该帧在除接口 1 以外的其他所有接口进行转发。</li><li>主机 B 在接收到该帧后，根据该帧的目的 MAC 地址 B 与自己的 MAC 地址比较，发现相等就说明该帧是发送给自己的，于是主机 B 接受该帧，主机 C 则会丢弃该帧。</li><li>该帧从交换机 1 的接口 4 通过交换机 2 的接口 2 进入交换机 2，交换机 2 首先进行登记工作，将该帧中的源 MAC 地址 A 记录到自己的帧交换表中，并且将接口号 2 与 MAC 地址 A 相对应也记录到帧交换表中</li><li>交换机 2 对该帧进行转发，该帧中的目的 MAC 地址是 B，在帧交换表中查找 MAC 地址 B，发现找不到就对该帧进行盲目地转发（也成为泛洪），也就说会将该帧在除接口 2 以外的其他所有接口进行转发。</li><li>主机 D、E、F 丢弃该帧<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/afc92e070ffd42bb9de873bf7989417a.png" alt></li></ul></li></ul><p><em>注意：在帧交换表中每条记录都有自己的有效时间，到期自动删除。这是因为 MAC 地址与交换机接口的对应关系并不是永久性的（对应的接口可能会更换计算机）</em><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/f7ad9fa661544ffdbe6bf75faab51916.png" alt></p><p><strong>3、以太网交换机的生成树协议 STP</strong></p><ul><li>思考：如何提高以太网的可靠性？假如在网络中有三台交换机 A、B、C，他们之间的连接方式如下图所示，假如他们之间的链路出现了故障则会影响各个交换机之间的通信<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c61f250b028847c8bd5ee61ef1fe6c35.gif" alt></li><li>添加<strong>冗余链路</strong>可以提高以太网的可靠性：在交换机 B 和 C 之间添加冗余链路。但是冗余链路也会带来负面效应 ---- 形成<strong>网络环路</strong>。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/8f898a1bafd0463ea91e45d10fafa3d6.png" alt></li><li>网络环路带来的问题<ul><li><strong>广播风暴</strong>：广播帧在各个交换机之间反复转发，分别按顺时针和逆时针方向同时兜圈。广播风暴会大量消耗网络资源，使得网络无法正常转发其他数据帧。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/45e9a422372e4ac7870aeb4e127e9cd7.png" alt></li><li><strong>主机收到反复的广播帧</strong>，会大量消耗主机的资源。</li><li><strong>交换机的帧交换表震荡</strong>：同一个 MAC 地址的记录在其他错误记录之间反复震荡。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/956f05ba2a864f088f5240b104da21c5.png" alt></li></ul></li><li>以太网交换机使用<strong>生成树协议 STP (Spanning Tree Protocol)<strong> 可以在增加冗余链路来提高网络可靠性的同时又</strong>避免网络环路带来的各种问题</strong>。<ul><li>不论交换机之间采用怎样的物理连接，交换机都能够<strong>自动计算并构建一个逻辑上没有环路的网络</strong>，其逻辑拓扑结构必须是<strong>树型</strong>的（无逻辑环路)。最终生成的树型逻辑拓扑要<strong>确保连通整个网络</strong>；</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/bad45fd1097c46439538d4e775dc9330.gif" alt></li><li>当首次连接交换机或网络<strong>物理拓扑发生变化</strong>时 (有可能是人为改变或故障)，交换机都将进行<strong>生成树的重新计算</strong>。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/9f1163b32c0349b5a401016c8f2fe070.gif" alt></li><li><em>说明：生成树算法 STA 需要大家自行了解。</em></li></ul></li></ul><h3 id="237-虚拟局域网vlan"><a class="anchor" href="#237-虚拟局域网vlan">#</a> 2.3.7 虚拟局域网 VLAN</h3><p><strong>1、广播域</strong><br>使用一个或多个以太网交换机互连起来的交换式以太网，其所有站点都属于同一个广播域。随着交换式以太网规模的扩大，广播域相应扩大，从而形成一个巨大的广播域。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/7cd6ccc8a1ff46fcae783b93767b6c97.png" alt></p><p>但是巨大的广播域会带来很多的弊端：</p><ul><li>广播风暴</li><li>难以管理和维护</li><li>潜在的安全问题</li></ul><p>例如，网络中的某台主机 A 需要向另外一台主机 B 发送数据，此时主机 A 只有主机 B 的 IP 地址，但是没有主机 B 的 MAC 地址，主机 A 需要发送 ARP（ARP 属于体系结构的网络层，在后续的课程中我们会介绍）广播请求来获取主机 B 的 MAC 地址，该 ARP 请求会传遍整个网络，网络中的其他所有主机都能够收到广播。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b3d39209b80e45748a16d0e034e867e1.png" alt></p><p>广播风暴会浪费网络资源和各个主机的 CPU 资源，但是在实际应用中网络中会频繁出现广播信息，TCP/IP 协议栈中的很多协议都会使用广播：</p><ul><li><strong>地址解析协议 ARP（已知 IP 地址，找出对应的 MAC 地址）</strong></li><li><strong>动态主机配置协议 DHCP（用于自动配置 IP 地址）</strong></li></ul><p>我们可以使用<strong>分割广播域</strong>的方法对广播域进行<strong>隔离</strong>：</p><ul><li><strong>使用路由器隔离广播域</strong>：但是路由器的成本较高，局域网中如果全部用路由器隔离广播域不大现实</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/a05712142deb48e6bb1755ba0eebb5f1.png" alt></li><li><strong>使用虚拟局域网 VLAN</strong></li></ul><p><strong>2、虚拟局域网 VLAN 概述</strong></p><p><strong>虚拟局域网 VLAN</strong> (Virtual Local Area Network) 是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求。</p><p>假如在网络中有三个局域网，分别叫做局域网 1、局域网 2、局域网 3，我们可以使用一个<strong>交换机 S4</strong> 将三个局域网互连成一个更大的局域网。原来每个局域网就成为新的大的局域网中的各个<strong>网段</strong>。我们可以在 S4 上将整个局域网划分成两个 VLAN：VLAN1 和 VLAN2，这样两个<strong>不同的 VLAN 之间的广播数据包不会互相传输</strong>，当然如果是在同一个 VLAN 中的主机依然可以进行广播通信。</p><p><em>注意：不是所有的交换机都能够进行 VLAN 划分，一般需要企业级交换机才可以。</em><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/bf54235f6dd94777bb14fe37fbe94968.png" alt></p><h3 id="238-华为ensp-vlan实验"><a class="anchor" href="#238-华为ensp-vlan实验">#</a> 2.3.8 华为 eNSP VLAN 实验</h3><p>下面我们使用华为的 eNSP 进行 VLAN 的实验。</p><p>1、新建一个拓扑，然后在拓扑中加入两台 S5700 的交换机 LSW1 和 LSW2，LSW1 和 LSW2 互相连接，并且每台交换机上接入两台 PC。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/61164790fff44f8ca510845b37beb561.png" alt></p><p>2、如上图所示：LSW1 交换机的 GE 0/0/1 和 GE 0/0/2 接口分别接 PC1 和 PC2， LSW2 交换机的 GE 0/0/1 和 GE 0/0/2 接口分别接 PC3 和 PC4，LSW1 和 LSW2 的 GE 0/0/3 接口互连。</p><p>3、对 PC1、PC2、PC3、PC4 进行如下设置：</p><ul><li>IP 地址分别设置为 192.168.1.101, 192.168.1.102, 192.168.1.103, 192.168.1.104</li><li>子网掩码全部设置为：255.255.255.0</li><li>网关全部设置为：192.168.1.0</li></ul><p>4、设置完成以后，将两台交换机和 4 台 PC 启动，然后分别在每台 PC 的命令行使用 ping 命令查看能够 ping 同其他 PC。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b1e6f3dc490941efb9a898acb587f28e.png" alt></p><p>5、配置交换机 LSW1，构建 vlan2 和 vlan3</p><ul><li>进入命令行输入 system-view 命令进入系统试图</li><li>输入 display vlan 查看交换机中的 vlan<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4ba5f05ed2f540eb93550fb5d774c718.png" alt></li><li>通过命令行，创建 vlan2<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/8b5f9b611538454aa041afd367520e16.png" alt></li><li>通过命令行，创建 vlan3<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2242b9748b3f4793b32202539daffc39.png" alt></li><li>输入命令 display vlan 查看交换机中的 vlan，发现有三个 vlan<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/8378ff6944164e0e9640ba7b0f430f9a.png" alt></li><li>将 0/0/1 和 0/0/2 端口设置为 access 类型：通过 access 端口的数据包都是不带 VLAN tag 的，且只属于一个 VLAN，在 access 端口进方向，交换机接收到数据包后，先判断是否带 VLAN tag，有则丢弃数据包，没有则打上该端口已配置的 VLAN tag，在 access 端口出方向，交换机将打了与端口相同 VLAN tag 的数据包转发出去，并且去掉 VLAN tag 变成普通数据包，一般连接计算机<ul><li>输入命令 dis cur 查看端口名称，注意：按回车键可以显示更多信息，按 ctrl + c 可以退出该命令<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/631e9003a02d41c2918b355bc52c413a.png" alt></li><li>设置 access 类型，并且将端口分配给不同的 VLAN<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/821fba44c98a466b8bcec572c88e700f.png" alt></li><li>因为 GE 0/0/1 端口接 PC1，并且 GE 0/0/1 端口分配给了 vlan2，所以 PC1 就在 vlan 2 中了，同理，PC3 在 vlan3 中，此时如果我们在 PC1 的命令行中 ping PC2 是不能 ping 通了，因为他们已经不在同一个局域网中了。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ec6a55f4c59b471c8524a4767658ce72.png" alt></li></ul></li><li>将 0/0/3 端口设置为 trunk 类型：端口可以承载多个 VLAN，通过 trunk 端口的数据包都必须带上 VLAN tag，在 trunk 端口进方向，交换机接收到数据包后，先判断是否带 VLAN tag，没有则丢弃数据包，有则按照对应 VLAN 进行转发，在 trunk 端口出方向，交换机将带 VLAN tag 的数据包原封不动转发出去，没有带 VLAN tag 数据包不会从 trunk 端口转发出去，一般用来接其他交换机<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/428ad8d56c5e42fda197a9fa7c3e5ba3.png" alt></li><li>设置完交换机 LSW1 后，用同样的方法设置交换机 LSW2，同样的将 0/0/1 端口分配给 vlan2，将 0/0/2 端口分配给 vlan3，0/0/3 端口设置为 trunk 模式。</li><li>设置完成以后，PC1 和 PC3 属于 vlan2， PC2 和 PC4 属于 vlan3<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4872f8c95a314fa8b0073508ea0c63a0.png" alt></li><li>我们可以在 PC1 和 PC2 上使用 ping 命令验证<ul><li>PC1 ping 命令<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/9b1696b0696c45409ed65640e705fcfa.png" alt></li><li>PC2 ping 命令</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/7fc63ad33a8a44b1af2b9c6b82f6f6be.png" alt></li></ul></li></ul><h2 id="24-网络层"><a class="anchor" href="#24-网络层">#</a> 2.4 网络层</h2><h3 id="241-网络层概述"><a class="anchor" href="#241-网络层概述">#</a> 2.4.1 网络层概述</h3><p>网络层的主要任务是实现<strong>网络互连</strong>，进而<strong>实现数据包在各网络之间的传输</strong>。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b3e6d491758c463e9e15f20412dc5b19.png" alt></p><p>要实现网络层任务，需要解决以下主要问题：</p><ul><li><strong>网络层向运输层提供怎样的服务（“可靠传输” 还是 “不可靠传输”)</strong><ul><li>TCP/IP 协议体系结构的网际层提供的是无连接的、不可靠的数据包服务</li><li>ATM、帧中继和 X.25 的网络层提供的是面向连接的、可靠的虚电路服务<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4d4d2143a06949dabd36e556678ae73b.gif" alt></li></ul></li><li><strong>网络层寻址问题</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4a220f98164244a7852948329d14224e.png" alt></li><li><strong>路由选择问题</strong>：路由器根据路由表选择下一跳</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/d15391af039249de8233d043f9097ec4.png" alt></li></ul><p><strong>因特网 (Internet) 是目前全世界用户数量最多的互联网，它使用 TCP/IP 协议栈</strong>。由于 TCP/IP 协议栈的网络层使用<strong>网际协议 IP</strong>，它是整个协议栈的核心协议，因此在 TCP/IP 协议栈中网络层常称为<strong>网际层</strong>。本章节我们通过学习 TCP/IP 协议栈的网际层来学习网络层的理论知识和实践技术。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e8aed8f8e204465286478ce215d5578f.png" alt></p><h3 id="242-ipv4地址概述"><a class="anchor" href="#242-ipv4地址概述">#</a> 2.4.2 IPv4 地址概述</h3><p>1、在因特网中，为了实现计算机之间的相互通信，通常需要为每台计算机分配一个 IP 地址。在互联网的发展过程中主要有两个版本的互联网协议，分别是<strong> IPv4</strong>（Internet Protocol version 4）和 <strong>IPv6</strong>（Internet Protocol version 6）。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/cc5e2eccc2d1450daf1168a36c462a68.png" alt></p><p><em>注意：在本课程中我们不对 IPv4 和 IPv6 的协议内容进行对比，只对比 IPv4 的 IP 地址和 IPv6 的 IP 地址。</em></p><p>2、IPv4 的 IP 地址就是给因特网 (Internet) 上的每一台主机 (或路由器)）的每一个接口分配一个在全世界范围内是唯一的<strong> 32 比特</strong>的标识符，地址总数为<strong> 2^32</strong> 个。</p><p>3、IPv6 的 IP 地址采用<strong> 128 比特</strong>地址长度，地址总数为<strong> 2^128</strong> 个。</p><p>4、IP 地址由<strong>因特网名字和数字分配机构 ICANN</strong> (Internet Corporation for Assigned Names and Numbers) 进行分配。我国用户可向<strong>亚太网络信息中心 APNIC</strong> (Asia Pacific Network Information Center) 申请 IP 地址，需要<strong>缴费</strong>。</p><p>5、因为当下互联网中的绝大多数设备采用的是 IPv4 的 IP 地址，所以本课程我们只学习 IPv4 的 IP 地址的相关知识。</p><p>6、由于 32 比特的 IPv4 地址不方便阅读、记录以及输入等，因此 IPv4 地址采用<strong>点分十进制</strong>表示方法以方便用户使用，例如：192.168.1.100</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/13b0092476264bb8896ba06fb40f7420.png" alt></p><p>7、八位无符号二进制整数转十进制：二进制表示中从右至左分别表示低比特位和高比特位。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/84e23b1a218f4f7aa58bed76b5949271.png" alt></p><p>8、十进制正整数转 8 位无符号二进制数的方法：</p><ul><li><p><strong>方法 1：除 2 取余法，直到最后商为 0</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/29b27d5759d44104bfd22974471bc7ab.png" alt></p></li><li><p><strong>方法 2：凑值法</strong> (必须熟记 8 位二进制数各位的权值 128 64 32 16 8 4 2 1)<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/77e2e3081651413582dbc509b1b6926e.png" alt></p><h3 id="243-ipv4-地址的分类"><a class="anchor" href="#243-ipv4-地址的分类">#</a> 2.4.3 IPv4 地址的分类</h3><p>1、IPv4 的 IP 地址由<strong>网络号</strong>（指定主机所属的网络）和 <strong>主机号</strong>（指定被寻址的子网中的某个节点）组成，IP 地址可以分为 A、B、C、D、E 五类。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/6464fc4fe345420e8947b63e1c5127ff.png" alt></p><p>2、注意事项：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/10dd518c2fa1475285bc8651361bcf3b.png" alt></p><p>3、各类 IP 地址的细节</p></li><li><p><strong>A 类地址</strong></p><ul><li>A 类地址的取值范围：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/306288ebc1084f9682ee3dcf184d93a9.png" alt></li><li>A 类地址可指派的网络数量：因为网络号占 8 个 bit，并且最高位固定为 0，网络号有 2^7=128 中组合，但是因为最小网络号 0 和最大网络号 127 不能指派，所以最终 A 类 IP 地址能够指派的网络数量为：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/6ced5ed4c9294f8095580e8e7745bb27.png" alt></li><li>A 类地址每个网络中可以分配的地址数量：因为主机号站 24 个 bit，主机号有 2^24 种组合，因为全 0 的网络号和全 1 的广播地址不能指派，所以需要减 2<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b69ad7bf6cb94c558057384a12d22c51.png" alt></li></ul></li><li><p><strong>B 类地址</strong></p><ul><li>B 类地址的取值范围：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/05de7fefd7ef4fb78f26469ed1004cb4.png" alt></li><li>B 类地址可指派的网络数量：因为网络号占 16 个 bit，并且最高位固定为 10，网络号有 2^(16-2) 种组合<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/a5d051c1e4ba401599405e2e57164d29.png" alt></li><li>B 类地址每个网络中可以分配的地址数量：因为主机号站 16 个 bit，主机号有 2^16 种组合，因为全 0 的网络号和全 1 的广播地址不能指派，所以需要减 2<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/98cb0741c2024e1198750e4cab33ca51.png" alt></li></ul></li><li><p><strong>C 类地址</strong></p><ul><li>C 类地址的取值范围<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/53e7a6fbc25a418baa2234dbc27351f0.png" alt></li><li>C 类地址可指派的网络数量：因为网络号占 24 个 bit，并且最高位固定为 110，网络号有 2^(24-3)<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/f29b2b0e71e44c878174d84236f98a6a.png" alt></li><li>C 类地址每个网络中可以分配的地址数量：因为主机号站 8 个 bit，主机号有 2^8 种组合，因为全 0 的网络号和全 1 的广播地址不能指派，所以需要减 2<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/5b617427ab1f4ccd9cdf3926f4daacb2.png" alt></li></ul></li><li><p><strong>D 类、E 类地址</strong><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/5d719a58afbb4b33870fdf7b48645552.png" alt></p></li><li><p>练习 1<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/aa63d155eeb24abda1d051f2257359a1.png" alt></p></li><li><p>练习 2</p></li><li><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4fb123caa43b4ea1b437b53dd26ad535.png" alt></p></li></ul><h3 id="244-子网的划分"><a class="anchor" href="#244-子网的划分">#</a> 2.4.4 子网的划分</h3><p>1、我们先来看一道笔试题：用一根网线直接相连的两台主机的 IP 地址分别为 192.168.1.100、192.168.2.100，请问使用什么方法可以让这两台主机能够进行正常的数据通信？</p><p>答案：<strong>将两台主机的子网掩码设置为 255.255.0.0</strong></p><p>2、子网掩码</p><ul><li><p>子网掩码 (subnet mask) 是一个<strong> 32 位</strong>地址，又叫网络掩码、地址掩码，它用来<strong>指明一个 IP 地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机</strong>。子网掩码不能单独存在，它必须结合 IP 地址一起使用。子网掩码<strong>将某个 IP 地址划分成网络地址和主机地址两部分</strong>。</p></li><li><p>左边是网络位，用二进制数字 “1” 表示，1 的数目等于网络位的长度；右边是主机位，用二进制数字 “0” 表示，0 的数目等于主机位的长度。这样做的目的是为了让掩码与 IP 地址做按位与运算时用 0 遮住原主机数，而不改变原网络段数字，而且很容易通过 0 的位数确定子网的主机数。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/74c187924a954a20b17c0e2be9be8ae7.png" alt></p></li><li><p>子网掩码的两个功能：</p><ul><li><strong>屏蔽 IP 地址的一部分以区别网络标识和主机标识</strong></li><li><strong>将一个大的 IP 网络划分为若干小的子网络</strong></li></ul></li><li><p>子网掩码的工作流程：将 32 位的子网掩码与 IP 地址进行二进制形式的按位逻辑 “与” 运算，得到该 IPv4 地址所在的网络地址<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/1fa492a5203a4e3e81e95fdb663dd989.png" alt><br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/81f103348f44489ca28910a60dda06ba.png" alt></p><p>3、子网的划分</p></li></ul><p>子网掩码是在 IPv4 地址资源紧缺的背景下为了解决 lP 地址分配而产生的<strong>虚拟 lP 技术</strong>，通过子网掩码将 A、B、C 三类地址划分为<strong>若干子网</strong>，从而显著<strong>提高了 IP 地址的分配效率</strong>，有效解决了 IP 地址资源紧张的局面。另一方面，在企业内网中为了更好地管理网络，网管人员也利用子网掩码的作用，人为地<strong>将一个较大的企业内部网络划分为更多个小规模的子网</strong>，再利用三层交换机的路由功能实现子网互联，从而有效<strong>解决了网络广播风暴和网络病毒</strong>等诸多网络管理方面的问题。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ac640d017ed242c995ec60898751cfbf.png" alt></p><p><strong>32 比特的子网掩码可以表明分类 IP 地址的主机号部分被借用了几个比特作为子网号。</strong></p><p>下面我们举例说明划分子网的细节：已知某个网络的地址为 218.75.230.0，使用子网掩码 255.255.255.128 对其进行子网划分，请给出划分细节。</p><p><em>解析流程：</em></p><ul><li>从 IP 地址坐起第一个十进制为 218，所以该 IP 地址为 C 类地址，C 类地址的子网掩码默认为：255.255.255.0，而此时给出的子网掩码为 255.255.255.128，则说明子网掩码向主机号借用了一个 bit 作为子网号<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/3b970806648446af9d613ec384a94f77.png" alt></li><li>因为子网掩码向主机号借用了一个 bit 作为子网号，所以可划分出来的子网数量为 2^1 = 2 个。每个子网可分配的地址数量为：2^(8-1) - 2 = 126 个。因为主机号的最高位被子网掩码借用了，主机号只有 7 位了，所以最多可分配 2^(8-1)=128 个地址，但是还需要去掉主机号为全 0 的网络地址和主机号为全 1 的广播地址所以还需要减 2。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/bc5b19420f224db2849fbba1a528b544.png" alt></li><li>详细的子网划分<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/bddeb4ea38a14ae081114a3685cd707e.png" alt></li></ul><p>4、练习题：我们通过一道考研真题对子网的划分方法进行巩固<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2ad399def58a4a848545929082aeaaf5.png" alt></p><p>5、子网掩码的<strong> CIDR 斜线记法</strong></p><p><strong>格式：IP 地址 /n</strong></p><p><em>说明：n 表示子网掩码所使用的 bit 数，表示子网掩码中网络号的长度，通过 n 的个数确定子网的主机数 = 2^(32-n)-2</em></p><p>例 1：192.168.1.100/24，其子网掩码表示为 255.255.255.0</p><p>例 2：172.16.198.12/20，其子网掩码表示为 255.255.240.0</p><h3 id="245-ip-协议"><a class="anchor" href="#245-ip-协议">#</a> 2.4.5 IP 协议</h3><p>1、<strong>用户数据</strong>在网络层（网际层）中使用<strong> IP 协议</strong>进行封装，然后交付给数据链路层。IP 协议提供<strong>不可靠无连接</strong>的<strong>数据报传输服务</strong>。</p><p>2、使用 IP 协议封装的数据我们称之为<strong> IP 数据报</strong>。</p><p>3、IP 数据报的首部：IP 数据报的首部由 20 个字节组成，IP 数据报的首部常以 32 个比特为单位进行描述，下图中的每一行都由 32 个比特（也就是 4 个字节）构成，每个小格子称为字段或者域。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/6a8fa94e8e6249e09d21fcff4035332e.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/0e59eaf8ddc34256889d3ebaf941473c.png" alt></p><ul><li>版本：占 4 比特，表示 IP 协议的版本</li><li>首部长度：占 4 比特，表示 IP 数据报首部的长度。该字段的取值以 4 字节为单位。最小十进制取值为 5，表示 lP 数据报首部只有 20 字节固定部分，最大十进制取值为 15，表示 IP 数据报首部包含 20 字节固定部分和最大 40 字节可变部分</li><li>区分服务：8 比特，一般不使用</li><li>总长度：占 16 比特，表示 IP 数据报的总长度（首部 + 数据载荷)。最大取值为十进制的 65535，以字节为单位（实际使用中不会传输这么长的 IP 数据报）。</li><li>标识、标志、片偏移：这三个字段共同用于 IP 数据报分片，以太网中数据链路层规定 MTU 的值为 1500 字节，如果某个 IP 数据报总长度超过 MTU，需要将原 IP 数据报分片成多个小的数据报，再将每个小的数据报封装成帧。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/1af7ec03c9754fc6b106836f0289e92f.png" alt><ul><li>标识：占 16 比特，属于同一个数据报的各分片数据报应该具有相同的标识。IP 软件维持一个计数器，每产生一个数据报，计数器值加 1，并将此值赋给标识字段。</li><li>标志：占 3 比特，各比特含义如下：<ul><li>DF 位：1 表示不允许分片，0 表示允许分片</li><li>MF 位：1 表示 “后面还有分片”，0 表示 “这是最后一个分片”</li><li>保留位：必须为 0</li></ul></li><li>片偏移：占 13 比特，指出分片数据报的数据载荷部分偏移其在原数据报的位置有多少个单位，片偏移以 8 个字节为单位。</li><li>IP 数据报分片举例<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/793e45ed3eb84af59a97785c1d246c50.png" alt></li></ul></li><li>生存时间：占 8 比特，最初以秒为单位，最大生存周期为 255 秒。路由器转发 IP 数据报时将 IP 数据报首部中的该字段的值减去 IP 数据报在本路由器上所耗费的时间，若不为 0 就转发，否则就丢弃。现在以 “跳数” 为单位，路由器转发 IP 数据报时，将 IP 数据报首部中的该字段的值减 1，若不为 0 就转发，否则就丢弃。<ul><li>TTL 作用可以防止 IP 数据报再网络中永久兜圈<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/612745a6ede640d6afd93607b4bafc50.png" alt></li></ul></li><li>协议：占 8 比特，指明 IPv4 数据报的数据部分是何种协议数据单元。常用的一些协议和相应的协议字段值如下。<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/79377238a89043919e018374f3d2ffd3.png" alt></li><li>首部检验和：占 16 比特，用来检测首部在传输过程中是否出现差错。比 CRC 检验码简单，称为因特网检验和。IP 数据报每经过一个路由器，路由器都要重新计算首部检验和，因为某些字段（生存时间、标志片偏移等) 的取值可能发生变化。</li><li>源 IP 地址：占 32 比特，表示发送主机的 IP 地址。</li><li>目的 IP 地址：占 32 比特，表示目的主机的 IP 地址。</li></ul><h3 id="246-ip数据报的发送和转发过程"><a class="anchor" href="#246-ip数据报的发送和转发过程">#</a> 2.4.6 IP 数据报的发送和转发过程</h3><p>IP 数据报的发送和转发过程包含两部分：<strong>主机发送 IP 数据报、路由器转发数据报</strong>。</p><p>假设在网络中由一台路由器连接了两个局域网，每个局域网的网络地址、子网掩码，以及每台主机的 IP 地址分配如下图所示：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c40175bcaad741188ca47b24958c9b9f.png" alt></p><p>请同学们思考：为什么左边网络的网络地址是：192.168.0.0，右边网络的网络地址是 192.168.0.128?</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/9592d08b343a47c59b6ceff582d2e0da.png" alt></p><p>同一个网络中的主机是可以直接通信的， 这叫做<strong>直接交付</strong>，而不同网络中间的主机是不能直接通信的，需要通过路由器进行中转，这属于<strong>间接交付</strong>。那<strong>源主机是如何判断目的主机和自己是否在同一个网络中呢</strong>？</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/19ca23c240b5425f82b87927deefea20.png" alt></p><p>主机 C 将自己的 IP 地址与子网掩码进行按位与操作得到主机 C 的网络地址：192.168.0.0，然后将目的主机的 IP 地址与自己的子网掩码进行按位与操作得到目的网络地址：192.168.0.128，发现两个网路并不相等，说明主机 C 和主机 F 不在同一个网络中，不能进行直接交付，主机 C 将数据发送给路由器 R，由路由器 R 再转发给主机 F，这样就实现了主机 F 和主机 F 之间的数据通信（间接交付）。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/0da67e5afd59402a8ccece46d4c7f271.png" alt></p><p>但是问题又来了：<strong>主机 C 又是如何知道要将数据发送给路由器 R 呢？我们需要将路由器的接口地址 192.168.0.126 作为主机 C 的默认网关</strong>，这样当主机 C 发现目的地址与自己不在同一网络中时则将数据发送给设置好的默认网关（路由器）。因此我们可以将左边网络中所有主机的默认网关填写为 192.168.0.126，将右边网络所有主机的默认网关填写为 192.168.0.254。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/60feba4a6ff94260a66942fb9fd63aa2.png" alt></p><p>那么路由器又是如何对数据进行转发的呢？假设主机 A 需要将数据发送给主机 D，因为主机 A 与主机 D 不在同一个网络，所以主机 A 将数据发送给路由器 R，路由器会进行如下操作：</p><ul><li>首先<strong>检查 lP 数据报首部是否出错</strong>：若出错，则直接丢弃该 lP 数据报并通告源主机，若没有出错，则进行转发</li><li>然后<strong>根据 IP 数据报的目的地址在路由表中查找匹配的条目</strong>：若找到匹配的条目，则转发给条目中指示的下一跳若找不到，则丢弃该 IP 数据报并通告源主机</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/67c3d16955764a238dabe8c3825f1148.png" alt></p><h3 id="247-路由表"><a class="anchor" href="#247-路由表">#</a> 2.4.7 路由表</h3><p><strong>1、什么是路由？</strong></p><p><strong>路由就是报文从源端到目的端的路径</strong>。当报文从路由器到目的网段有多条路由可达时，路由器可以根据路由表中最佳路由进行转发。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/8201cdba7aaa47839645e53190adb8a9.png" alt></p><p><strong>2、什么是路由表？</strong></p><p>在计算机网络中，路由表（routing table）是一个<strong>存储在路由器或者联网计算机中的电子表格（文件）或类数据库。路由表存储着指向特定网络地址的路径。路由表建立的主要目标是为了实现路由协议和静态路由选择。路由表就相当于一张地图告诉数据报该如何去往目的地。</strong></p><p>路由器会根据路由表进行数据包的转发：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/369ba24380f547558e9707647cff01e1.png" alt></p><p>在 ubuntu 系统下我们可以使用<strong> route -n</strong> 命令查看系统的路由表：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/cd926f3edc0c4d5e93455da903db9395.png" alt></p><p>在 windows 下可以使用 <strong>route print</strong> 命令查看系统的路由表：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/17f7e6a44a3e4a2dafc78142a2b31ec0.png" alt></p><p>我们发现 ubuntu 和 windows 系统的路由表中都有一条特殊的路由：目标地址为全网地址 0.0.0.0 ，子网掩码为 0.0.0.0，对应下一跳的地址为网关地址。那么这条路由的作用是什么呢？</p><p>我们先了解一下，计算机或者路由器是如何将一条数据通过网络发送出去的。首先将目的 IP 地址与自己的子网掩码进行按位与运算得到目的主机的主机号，然后拿该主机号与路由表中的路由进行匹配，如果匹配到了则将数据转发给指定的下一跳，如果没有匹配到，则转发给目标地址为 0.0.0.0 所对应的下一跳。</p><p><strong>因此目标地址为 0.0.0.0 所对应的那条路由的作用就是：这条路由就是我们所说的默认路由，是对 IP 数据包中的目的地址找不到存在的其他路由时，路由器所选择的路由。</strong></p><p><em>注意 1：当我们发现主机（尤其是一些嵌入式或者物联网的设备）不能够上网或者不能 ping 通外网的时候，假如检查了 IP 地址、DNS 等设置都没问题后依然不能解决，我们可以查看系统的路由表中是否没有添加默认路由。</em></p><p><em>注意 2：不同的路由器查看路由表的命令不一样</em></p><p><em><strong>思科路由器查看路由表命令为：show ip route</strong></em></p><p><em><strong>华为路由器查看路由表命令为：display ip routing-table</strong></em></p><p><strong>3、路由表的类型</strong></p><p>路由表可以分为：静态路由和动态路由。</p><ul><li><strong>动态路由</strong>：动态路由是指动态路由协议 (如 RIP) 自动建立路由，并且能够根据实际情况的变化适时地进行调整。<ul><li>动态路由之所以能根据网络的情况自动计算路由、选择转发路径，是由于当网络发生变化时，路由器之间彼此交换的路由信息会告知对方网络的这种变化，通过信息扩散使所有路由器都能得知网络变化。</li><li>路由器根据某种路由算法（不同的动态路由协议算法不同）把收集到的路由信息加工成路由表，供路由器在转发 IP 报文时查阅</li><li>常见的动态路由协议有：RIP、OSPF、IS-IS、BGP、IGRP/EIGRP</li></ul></li><li><strong>静态路由</strong>：由网络管理员手动配置的路由。<ul><li>Linux 系统静态路由操作：<ul><li>添加路由：<strong>route -n add -net 目标地址 / 子网掩码位数 gw 下一跳</strong>，例如：route -n add -net 192.168.1.0/24 192.168.33.2</li><li>添加默认路由：<strong>route add default gw IP</strong></li><li>删除路由：<strong>route delete -net 目标地址 / 子网掩码位数</strong>，例如：route delete -net 192.168.1.0/24</li><li><strong>注意：参数 - net 表示操作某个网段，如果操作的数具体某台主机的地址则使用 - host 选项</strong></li></ul></li><li>路由器静态路由操作：<ul><li>添加路由：<strong>ip route 目标地址 子网掩码 下一跳地址</strong>，例如：ip route 192.168.3.0 255.255.255.0 192.168.1.1</li><li>删除路由：<strong>no ip route 目标地址 子网掩码 下一跳地址</strong></li></ul></li></ul></li></ul><p><strong>4、路由表实验</strong></p><p>下面我们使用思科的模拟器 Cisco Packet Tracer 进行路由表的实验</p><p>1）首先我们先搭建基础的网络，如下图所示：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/12bbff9b306e404aa674f9e7070108e7.png" alt></p><p>2）在此次实验中我们通过设置三个路由器的路由表实现主机 PC0 与主机 PC1 之间的通信</p><p>3）分别设置主机 PC0 与主机 PC1 的 ip 地址</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e77b2a0699894561af591792694c3f1b.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/801c18c5050049c29aa4f28b61e30c6d.png" alt></p><p>4）分别设置三台路由器的 IP 地址</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4b6100b8a1d7457884d3243864ffdd58.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c13b9dde6117465fb83e5eda615b1c6b.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e94f894fb5dd47afa921b46f7ec4afe0.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/95ef89948e9848af95110c53bc8a9861.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/69e3de3fb76a43d8b7888ba6ab7f11d0.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/96ca5270764d40079c8f318feadbcc58.png" alt></p><p>5）分别为三个路由器设置静态路由</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/a7244af258fa42c5ab16f0205245b6ed.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/5e71211c041542ff99590cdfe59fa281.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/a03f5983b1e842c88bfdb7cf24ff3b69.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/3fbc6da2c94b4f58bf176648e59c3b3c.png" alt></p><p>6）在 PC0 尝试 ping PC1</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/75166cbf55634638939decf683ac17e5.png" alt></p><h3 id="248-arp高速缓存表"><a class="anchor" href="#248-arp高速缓存表">#</a> 2.4.8 ARP 高速缓存表</h3><p><strong>1、地址解析协议 ARP</strong></p><ul><li><p>通过前面的学习，我们知道：如果网络中的主机需要互相通信，那么源主机必须要知道目的主机的 IP 地址和 MAC 地址，因为在数据链路层封装的 MAC 帧中需要封装目的地址和源地址。当已知目的主机的 IP 地址时，可以<strong>通过 ARP 协议获得目的主机的 MAC 地址。</strong></p></li><li><p>ARP 请求报文封装在 MAC 帧中，目的地址为 FF-FF-FF-FF，并且以广播的形式发送的。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/25de6ea226184a57a6a730cf818b2d71.png" alt></p></li><li><p>ARP 协议工作流程</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/984f2cb9f75549c2a6e4e1f249170816.png" alt></p></li></ul><p><strong>2、ARP 高速缓存表</strong></p><p>ARP 高速缓存 (ARP cache)，由最近的 ARP 项组成的一张临时表，表中记录了<strong>主机 IP 地址和 MAC 地址的对应关系</strong>。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/9c0c0912b4dc4ad39587fd9c9a72d685.png" alt></p><p><strong>注意：ARP 报文只能在发送主机所在的广播域中被使用！</strong></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2ccf4bf2ce964086ac1bcc8ace63002e.png" alt></p><p><strong>3、ARP 欺骗</strong></p><p>ARP 欺骗是一种以 <strong>ARP 地址解析协议为基础</strong>的一种网络攻击方式。</p><p>ARP 欺骗的原理：利用<strong> ARP 协议没有安全认证机制</strong>，攻击者发送假的 ARP 数据包到网上，尤其是送到网关上。其目的是要让送至特定的 IP 地址的流量被错误送到攻击者所取代的地方。因此攻击者可将这些流量另行转送到真正的网关（被动式数据包嗅探，passive sniffing）或是篡改后再转送（中间人攻击，man-in-the-middle attack）。</p><p>ARP 欺骗分为两种：</p><ul><li>主机型欺骗：攻击者向其他主机发送 ARP 响应包，攻击者在响应包中填入网关的 IP 地址和自己 MAC 地址，这样主机 A 应该发送给网关的数据包会被网关转发给主机 B</li><li>网关型欺骗：攻击者向网关发送 ARP 响应包，攻击者在响应包中填入被攻击主机的 IP 地址和自己 MAC 地址，这样网关接收到互联网中发给主机 A 的数据时也会转发给主机 B</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4435eed3d6ea419fb434761a876bc276.png" alt></p><p>ARP 欺骗的危害：</p><ul><li>信息安全收到威胁</li><li>网络延迟增加</li><li>网络通信中断</li></ul><p>ARP 欺骗防范方法：</p><ul><li>安装补丁</li><li>静态绑定：网内的主机与网关做 IP 和 MAC 绑定</li><li>使用 ARP 防火墙</li><li>不要点开通讯工具中的一些可疑链接、图片、文件等。</li></ul><h3 id="249-特殊ip地址"><a class="anchor" href="#249-特殊ip地址">#</a> 2.4.9 特殊 IP 地址</h3><p><strong>1、127.0.0.1</strong></p><p>回环地址，该地址还有 一个别名叫 “localhost”，无论是哪个程序，一旦使用该地址发送数据，协议软件会立即返回，不进行任何网络传输，除非出错，包含该网络号的分组是不能够出现 在任何网络上的。</p><p><strong>2、10. <code>*</code> . <code>*</code> . <code>*</code> ，172.16. <code>*</code> . <code>*</code> ――172.31. <code>*</code> . <code>*</code> ，192.168. <code>*</code> . <code>*</code></strong></p><p>上面三个网段是私有地址，可以用于自己组网使用，这些地址主要用于企业内部网络中，但不能够在 Internet 网上使用，Internet 网没有这些地址 的路由，而使用这三个网段的计算机要上网必须要通过网络地址转换 (NAT)，将私有地址翻译成公用合法的 IP 地址。</p><p><strong>3、255.255.255.255</strong></p><p>受限制的广播地址，对本机来说，这个地址指本网段内 (同一个广播域) 的所有主机，该地址用于主机配置过程中 IP 数据包的目的地址，这时主机可能还不知道它 所在网络的网络掩码，甚至连它的 IP 地址也还不知道。在任何情况下，路由器都会禁止转发目的地址为受限的广播地址的数据包，这样的数据包仅会出现在本地网络中。</p><p><strong>4、224.0.0.0—239.255.255.255</strong></p><p>组播地址</p><p><strong>5、169.254. <code>*</code> . <code>*</code></strong></p><p>如果你的主机使用了 DHCP 功能自动获得一个 ip 地址，那么当你的 DHCP 服务器发生故障或响应时间太长而超出系统规定的一个时间，windows 系统会为你分配这样一个地址。如果你发现你的主机 ip 地址是个诸如此类的地址，很不幸，十有八九是你的网络不能正常运行了。</p><p><strong>6、114.114.114.114</strong></p><p>中国电信 DNS</p><p><strong>7、8.8.8.8</strong></p><p>谷歌 DNS</p><h2 id="25-运输层"><a class="anchor" href="#25-运输层">#</a> 2.5 运输层</h2><h3 id="251-运输层概述"><a class="anchor" href="#251-运输层概述">#</a> 2.5.1 运输层概述</h3><p>之前课程所介绍的计算机网络体系结构中的物理层、数据链路层以及网络层它们共同解决了将主机通过异构网络互联起来所面临的问题，实现了主机到主机的通信。两个主机进行通信实际上就是两个主机中的<strong>应用进程互相通信</strong>，应用进程之间的通信又称为<strong>端到端的通信</strong>。</p><p>当网络的边缘部分中的两个主机使用网络的核心部分的功能进行端到端的通信时，只有位于<strong>网络边缘部分的主机</strong>的协议栈才有运输层，而网络核心部分中的路由器在转发分组时都只用到下三层的功能。<strong>如何为运行在不同主机上的应用进程提供直接的通信服务是运输层的任务</strong>。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/35de417d8a074dfb898629ff42762bed.png" alt></p><p>运输层提供的是应用进程间的<strong>逻辑通信</strong>，“逻辑通信” 的意思是：运输层之间的通信好像是沿水平方向传送数据。但事实上这两个运输层之间并没有一条水平方向的物理连接。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c3e695530ec4467db6883a5d8f664711.png" alt></p><h3 id="252-端口号"><a class="anchor" href="#252-端口号">#</a> 2.5.2 端口号</h3><p><strong>1、思考</strong></p><p><strong>主机 A 使用 QQ 向 PC 发送了一组数据，数据在网络中经过传输后到达主机 B，主机 B 对数据进行解包以后又是如何知道该数据是发送给哪个进程的呢？</strong></p><p>TCP/IP 体系的运输层使用<strong>端口号</strong>来区分应用层的不同应用进程。</p><p><strong>2、端口号的值</strong></p><ul><li>端口号使用<strong> 16 比特</strong>表示，取值范围 0~65535</li><li>熟知端口号：0~1023，IANA 把这些端口号指派给了 TCP/IP 体系中最重要的一些应用协议，例如：<strong>FTP 使用 21/20，HTTP 使用 80，DNS 使用 53</strong>。</li><li>登记端口号：1024~49151，为没有熟知端口号的应用程序使用。使用这类端口号必须在 IANA 按照规定的手续登记，以防止重复。例如：Microsoft RDP 微软远程桌面使用的端口是 3389。</li><li>短暂端口号：49152~65535，留给客户进程选择暂时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号。通信结束后，这个端口号可供其他客户进程以后使用。</li><li>常用端口号及对应的网络应用程序表格如下：</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c48154d2fc544ceeadd960656632e024.png" alt></p><ul><li>在 Linux 中 /etc/service 文件中保存了知名的服务器端口号</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/fd34cda6cf984c2a9a0fd954588e4154.png" alt></p><ul><li><strong>端口号只具有本地意义</strong>，即端口号只是为了标识本计算机应用层中的各进程，在因特网中，不同计算机中的相同端口号是没有联系的。</li></ul><h3 id="253-传输控制协议tcp"><a class="anchor" href="#253-传输控制协议tcp">#</a> 2.5.3 传输控制协议 TCP</h3><p>传输控制协议 TCP (Transmission Control Protocol) 一种<strong>基于连接的可靠的稳定的无重复的传输协议</strong>。</p><p><strong>1、TCP 头部信息</strong></p><p>TCP 协议头部信息如下：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/1635157ce88b4a5490fe330274ea253d.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/60f25c753f3545c4931ad4018307698d.png" alt></p><ul><li><strong>16 位源端口号（Source Port）</strong>：发送主机中进程的端口号</li><li><strong>16 位目的端口号（Destination Port）</strong>：接收主机中进程的端口号</li><li><strong>32 位序列号（Sequence Number）</strong>：每一个包中都包含序列号，序列号被系统初始化为某个随机值 ISN。后续的 TCP 报文段中序号加上该报文段所携带数据的第一个字节在整个字节流中的偏移。例如，某个 TCP 报文段传送的数据是字节流中的第 1025～2048 字节，那么该报文段的序号值就是 ISN+1025</li><li><strong>32 位确认号（Acknowledgment Number）</strong>：目的主机返回确认号，使源主机知道某个或几个报文段已被接收</li><li><strong>四位首部长度（Header Length）</strong>：由于 TCP 首部包含一个长度可变的选项部分，所以需要这么一个值来指定这个 TCP 报文段到底有多长</li><li><strong>URG 标志</strong>：表示紧急指针（urgent pointer）是否有效</li><li><strong>ACK 标志</strong>：表示确认号是否有效。我们称携带 ACK 标识的 TCP 报文段为确认报文段</li><li><strong>PSH 标志</strong>：提示接收端应用程序应该立即从 TCP 接收缓冲区中读走数据，为接收后续数据腾出空间（如果应用程序不将接收到的数据读走，它们就会一直停留在 TCP 接收缓冲区中）</li><li><strong>RST 标志</strong>：表示要求对方重新建立连接。我们称携带 RST 标志的 TCP 报文段为复位报文段</li><li><strong>SYN 标志</strong>：表示请求建立一个连接。我们称携带 SYN 标志的 TCP 报文段为同步报文段</li><li><strong>FIN 标志</strong>：表示通知对方本端要关闭连接了。我们称携带 FIN 标志的 TCP 报文段为结束报文段</li><li><strong>16 位窗口大小（window size）</strong> ：是 TCP 流量控制的一个手段。这里说的窗口，指的是接收通告窗口（Receiver Window，RWND）。它告诉对方本端的 TCP 接收缓冲区还能容纳多少字节的数据，这样对方就可以控制发送数据的速度</li><li><strong>16 位校验和（TCP check sum）</strong>： 由发送端填充，接收端对 TCP 报文段执行 CRC 算法以检验 TCP 报文段在传输过程中是否损坏。注意，这个校验不仅包括 TCP 头部，也包括数据部分。这也是 TCP 可靠传输的一个重要保障。</li><li><strong>16 位紧急指针（urgent pointer）</strong> ：是一个正的偏移量。它和序号字段的值相加表示最后一个紧急数据的下一字节的序号。因此，确切地说，这个字段是紧急指针相对当前序号的偏移，不妨称之为紧急偏移。TCP 的紧急指针是发送端向接收端发送紧急数据的方法。</li><li><strong>TCP 头部选项</strong> ：TCP 头部的最后一个选项字段（options）是可变长的可选信息。这部分最多包含 40 字节</li></ul><p><strong>2、TCP 运输连接的阶段</strong></p><ul><li>建立 TCP 连接</li><li>数据传输</li><li>释放 TCP 连接</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/f769ce54c8ec4e77a8b1c9a5fb041c7d.png" alt></p><p><em>注意：三报文握手我们也称之为三次握手或者三路握手，四报文挥手我们也称之为四次挥手或者四路挥手</em></p><p><strong>3、TCP 连接的建立</strong></p><p>TCP 连接的建立需要解决以下三个问题：</p><ul><li>使 TCP 双方能够确知对方的存在</li><li>使 TCP 双方能够协商一些参数（如最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等)</li><li>使 TCP 双方能够对运输实体资源（如缓存大小、连接表中的项目等) 进行分配</li></ul><p><strong>三次握手过程</strong>：</p><ul><li>由客户端的某个进程主动发起 TCP 连接建立，最初两端的 TCP 进程都处于<strong>关闭状态</strong></li><li>TCP 服务器被动等待客户进程的 TCP 请求，所以 TCP 服务器进入<strong>监听状态</strong></li><li>TCP 客户进程向 TCP 服务器进程发送 TCP 建接请求报文段，并且进入<strong>同步已发送状态</strong></li><li>TCP 连接请求报文段首部中的同步位<strong> SYN</strong> 被设置为 1，表明这是一个 TCP 连接请求报文段，32 位序列号字段<strong> seq</strong> 被设置了一个初始值 x，作为 TCP 客户进程所选择的初始序号。</li><li>TCP 服务器进程接收到 TCP 连接请求报文段后，如果同意建立连接，则向 TCP 客户进程发送 TCP 连接请求确认报文段，并且进入<strong>同步已接收状态</strong>，该报文段首部中的<strong>同步位 SYN 和确认位 ACK 都设置为 1</strong>，表明这是一个 TCP 连接请求确认报文段。<strong>序号字段 seq 被设置了一个初始值 y</strong>，作为 TCP 服务器进进程选择的初始序号，<strong>确认号字段 ack 的值被设置成 x+1</strong>，表明接收到了 TCP 客户进程序号为 x 的报文。</li><li>TCP 客户进程收到 TCP 连接请求确认报文段后，还要向 TCP 服务器进程发送一个普通的 TCP 确认报文段，并且进入连接已建立状态，报文段首部中的<strong>确认位 ACK 设置为 1</strong>，表明这是一个普通的 TCP 确认报文段。序列号字段<strong> seq</strong> 设置为 x+1，确认号字段<strong> ack 的值被设置成 y+1</strong>，表明接收到了 TCP 服务进程序号为 y 的报文，TCP 服务器进程收到该确认报文段后也进入<strong>连接已建立状态</strong>。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2a6ce72a806c44679a6f2bb7b31862e4.png" alt></p><ul><li>思考：假如 TCP 连接的建立使用两次握手而不是三次握手可以吗？<ul><li>假设 TCP 客户进程发送了一个 TCP 请求报文段，但是该报文段在网络结点中被长时间滞留了，TCP 客户采用超时重传机制重发 TCP 请求报文段并且被 TCP 服务进程接收，TCP 服务进程发送一个 TCP 连接请求确认报文段，然后 TCP 服务进程和客户进程可以进行数据的传输，数据传输完成以后双方都处于关闭状态。</li><li>随后滞留在网络结点中的那个失效的 TCP 请求报文段被 TCP 服务进程接收，TCP 服务进程又发送一个 TCP 连接请求确认报文段，并且进入连接已建立状态，由于 TCP 客户进程并没有发起新的 TCP 连接请求，并且已经处于关闭状态了，因此不会理会 TCP 服务器发送的报文段，但是 TCP 服务器进程已经进入了连接已建立状态，他认为新的 TCP 连接已经建立好了，就会一直等待 TCP 客户进程发来数据，将会浪费 TCP 服务器主机的很多资源。</li></ul></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/3bbe482d02224af2a10b1878d3c20d2d.png" alt></p><ul><li>因此：TCP 连接的建立必须采用三次握手。</li><li>练习：<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/6d8a06cf638e4c1abdee3216f2ce2681.png" alt></li></ul><p><strong>四次挥手过程</strong>：TCP 通过四次挥手来释放连接，数据通信结束后，TCP 双方都可以释放连接</p><ul><li>假设由客户进程主动关闭 TCP 连接</li><li><strong>客户进程发送连接释放报文段</strong>，并且进入<strong>终止等待 1 状态</strong>，该报文段中的首部终止位 FIN 设置位 1，ACK 设置为 1，表明这是一个连接释放报文段，同时也对之前接收打报文段进行确认，seq=u 表示 TCP 客户进程之前已发送过的数据的最后一个字节的序号 + 1，ack=v 表示客户进程之前已收到的数据的最后一个字节的序号 + 1</li><li>服务器进程接收到 TCP 连接释放报文段后，会<strong>发送一个普通的 TCP 确认报文段并且进入关闭等待状态</strong>，此时 TCP 客户进程到服务器进程这个方向的连接就释放了，这时的 TCP 连接属于<strong>半关闭状态</strong>，也就是 TCP 客户进程已经没有数据要发送了，但是 TCP 服务器进程如果还有数据需要发送，客户进程则还需要接收，这个状态可能会持续一段时间，直到 TCP 服务器进程将数据发送完毕。</li><li><strong>TCP 客户进程</strong>收到 TCP 确认报文段后就进入<strong>终止等待 2 状态</strong>，等待 **TCP 服务器进程发出的 TCP 连接释放报文段。</li><li>当 TCP 服务器进程的没有数据要发送了后，释放连接（被动关闭），<strong>TCP 服务器进程发送 TCP 连接释放报文段并进入最后确认状态</strong>。FIN=1，ACK=1 表明这是一个连接释放报文段，seq=w，ack=u+1 同时也对之前收到的报文段进行确认。思考：为什么 seq=w，而不是 seq=v+1 呢？</li><li>TCP 客户进程收到 TCP 连接释放报文段后，必须针对该报文段发送普通的 TCP 确认报文段，之后进入时间等待状态</li><li>TCP 服务器进程收到该报文段后就进入关闭状态</li><li>而 TCP 客户进程还需要经过<strong> 2MSL</strong> 后才能进入关闭状态。MSL (Maximum Segment Lifetime) 意思是<strong>最长报文段寿命</strong>，RFC793 建议为<strong> 2 分钟</strong>。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e07d69f9129d47d4970fa4b45f340dad.png" alt></p><ul><li>思考：为什么 TCP 客户进程还需要经过<strong> 2MSL</strong> 后才能进入关闭状态？<ul><li>假设 TCP 客户进程收到 TCP 连接释放报文段，并且针对该报文段发送普通的 TCP 确认报文段后马上进入关闭状态，但是该确认报文段丢失了，TCP 服务器进程无法收到该确认报文段，TCP 服务器程序就会以为之前发送的 TCP 连接释放报文段 TCP 客户进程没有收到，然后 TCP 服务器进程会对之前所发送的 TCP 连接释放报文段超时重传，并仍处于最后确认状态。由于 TCP 客户进程已经处于关闭状态了，不会处理 TCP 服务器进程发送的连接释放报文段，这样就会造成 TCP 服务器反复发送 TCP 连接释放报文段，并且一直处于最后确认状态而无法进入关闭状态。因此客户端等待 2MSL 可以确保服务器进程收到最后一个 TCP 确认报文。</li></ul></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/461b23d584c0464995a45a3fa1576713.png" alt></p><h3 id="254-tcp可靠传输的实现"><a class="anchor" href="#254-tcp可靠传输的实现">#</a> 2.5.4 TCP 可靠传输的实现</h3><p><strong>1、分段传输</strong>：应用数据根据 MSS（Maxitum Segment Size 最大分段大小，这个值 TCP 协议在实现的时候往往用 MTU 值代替（需要减去 IP 数据包包头的大小 20Bytes 和 TCP 数据段的包头 20Bytes）所以往往 MSS 为 1460 ）值被分割成 TCP 认为最适合发送的数据段。</p><p>注意：在运输层的分段传输（分组传输）和网络层的 IP 数据报分片传输的区别：分段传输只有 TCP 协议才有的，并且分段的依据为 MSS，分片传输的依据为 MTU。</p><p><strong>2、超时重传</strong>：当 TCP 发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段。</p><p><strong>3、CRC 校验和</strong>：TCP 将保持它首部和数据的检验和如果收到段的检验和有差错，TCP 将丢弃这个报文段和不确认收到此报文段。</p><p><strong>4、流量控制</strong>：TCP 提供一种机制可以让「发送方」根据「接收方」的实际接收能力控制发送的数据量，这就是所谓的流量控制。TCP 连接的每一方都有固定大小的缓冲空间，TCP 的接收端只允许发送端发送接收端缓冲区能接纳的数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP 使用的流量控制协议是<strong>可变大小的滑动窗口协议</strong>。接收方有即时窗口（滑动窗口），随 ACK 报文发送。<strong>（TCP 利用滑动窗口实现流量控制）</strong></p><p><strong>5、滑动窗口</strong>：</p><ul><li>应答机制：假如 TCP 每发送一个数据报，都要进行一次确认应答。当上一个数据包收到了应答了， 再发送下一个，这个模式就有点像我和你面对面聊天，你一句我一句。这样的传输方式有一个缺点：<strong>数据包的往返时间越长，通信的效率就越低</strong>。为解决这个问题，我们可以使用累计应答。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/94702c93213041f7b4d74d25995dcd13.png" alt></p><ul><li><strong>累计应答</strong>：接收方在接收到多个数据包后再根据接收到的数据包进行应答，也称为<strong>累计确认</strong>。</li><li><strong>窗口</strong>：窗口的实现实际上是操作系统开辟的一个<strong>缓存空间</strong>，接收方根据实际情况在应答数据包中告知自己的接收窗口大小。<strong>窗口大小就是指无需等待确认应答，而可以继续发送数据的最大值（以字节为单位）</strong>。发送方主机在等到确认应答返回之前，必须在缓冲区（发送窗口）中保留已发送的数据。如果按期收到确认应答，此时数据就可以从缓存区清除。</li><li><strong>滑动窗口</strong>：如果发送窗口左部的字节已经发送并且收到了确认，那么就将发送窗口向右滑动一定距离，直到左部第一个字节不是已发送并且已确认的状态；接收窗口的滑动类似，接收窗口左部字节已经发送确认并交付主机，就向右滑动接收窗口。<ul><li>假设主机 A 发送数据给主机 B，在建立 TCP 连接时，主机 B 在确认报文中将自己的接收窗口 rwnd 告知主机 A。（假设接收窗口大小为 400）</li><li>主机 A 根据主机 B 的接收窗口大小创建自己的发送窗口（在内存上开辟一块空间缓存一个接收窗口大小的数据），并且假设每个数据包中载荷数据为 100Bytes</li><li>主机 A 分别将第一组数据（为了方便讲解假设 seq=1，实际上应该为 seq=ISN+1）, 第二组数据 (seq=101)、第三组数据 (seq=201)、第四组数据 (seq=301) 发送给主机 B，中间不需要等待主机 B 的应答数据报（累计应答）</li><li>假设第三组数据（seq=201）在输出过程中被丢失了，尽管主机 B 接收到了第四组数据，但是因为累计应答时只应答最大连续报文，所以应答数据包中 ack=201 表示序号 201 之前的所有数据全部正确接收。假设主机 B 将接收窗口大小调整为 300，在应答报文中 rwnd=300</li><li>主机 A 接收到应答数据报后，将自己发送窗口中的序号 1~200 的数据删除，发送窗口往前（向右）移动并且将大小重新设置为 300（开辟接收窗口大小的缓存序号为 201-500 的数据）</li><li>主机 B 将序号为 201，301，401 的数据报发送给主机 B</li><li>假设以上三组数据报没有丢失，主机 B 在接收到所有数据后发送应答数据报，ack=501，并且将窗口调整为 100，rwnd=100A</li><li>主机 A 接收到应答数据报后，将自己发送窗口中的序号 201~500 的数据删除，发送窗口往前（向右）移动并且将大小重新设置为 100（开辟接收窗口大小的缓存序号为 501-600 的数据）</li><li>主机 A 将序号位 600 的数据报发送给主机 B ，按照以上逻辑知道数据发送完毕。</li></ul></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/1a6be778013148e2af24f50725672040.png" alt></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/1a6be778013148e2af24f50725672040.png" alt></p><ul><li><strong>接收窗口为 0 的处理</strong>：当发送窗口被调整为 0 后，发送方就不能再发送数据了，假如接收方的接收窗口调整为大于 0 了，如果不采取特殊措施发送方是不知道的，因为接收方不会主动告知发送方自己接收窗口的大小。这时就需要持续计数器了，当发送方接收到接收窗口为 0 的应答报文时马上启动一个<strong>持续计时器</strong>，当定时达到时主动向接收方发送一个<strong>零窗口探测报文</strong>，该报文只携带一个字节的数据，然后这种逻辑直到接收方回复的接收窗口大于 0。</li><li><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/d44e97c3a3b74fb0872e118d5f235858.png" alt></li></ul><h3 id="255-用户数据报协议udp"><a class="anchor" href="#255-用户数据报协议udp">#</a> 2.5.5 用户数据报协议 UDP</h3><p><strong>1、UDP 概述</strong></p><p>UDP 是 User Datagram Protocol 的简称， 中文名是用户数据包协议。</p><p>UDP 是一种无连接的不可靠的传输协议（不需要进行三次握手和四次挥手）。</p><p>UDP 不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的，因此适合实时数据传输，例如：<strong>IP 电话、网络视频会议</strong>等实时应用。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/0c34cec48016474689abbe7c127ddac0.png" alt></p><p><strong>2、UDP 的头部</strong></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/59232102df5d4d7e8a6d0f5e454eab69.png" alt></p><p><strong>3、UDP 的应用</strong></p><p><strong>使用 UDP 运输协议可以进行单播、多播和广播</strong>。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/956d8665e1f94a599442d91a23fab6ca.png" alt></p><ul><li><p><strong>单播应用：DNS 域名解析</strong>，域名系统是因特网上作为域名和 IP (Internet Protocol Address) 地址相互映射的一个分布式数据库。</p><ul><li>浏览器如何通过域名去查询 URL 对应的 IP（对应服务器地址）呢？<ul><li>浏览器缓存：浏览器会按照一定的频率缓存 DNS 记录。</li><li>操作系统缓存：如果浏览器缓存中找不到需要的 DNS 记录，那就去操作系统中找。</li><li>路由缓存：路由器也有 DNS 缓存。</li><li>ISP 的 DNS 服务器：ISP 是互联网服务提供商 (Internet Service Provider) 的简称，ISP 有专门的 DNS 服务器应对 DNS 查询请求</li><li>根服务器：ISP 的 DNS 服务器还找不到的话，它就会向根服务器发出请求，进行递归查询</li></ul></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/cfbd109c37634f678e769c57fdbe5b1b.png" alt></p><ul><li><strong>当两个网络应用进程间需要快速传输大文件（音视频文件、图片文件等）时也可以使用 UDP 单播。</strong></li></ul></li><li><p><strong>多播应用：网络视频会议、教学，视频监控等</strong>。IP 多播（也称多址广播或组播）技术，是一种允许一台或多台主机（多播源）发送单一数据包到多台主机（一次的，同时的）的 TCP/IP 网络技术。IP 多播通信必须依赖于 IP 多播地址，在 IPv4 中它是一个 D 类 IP 地址，范围从<strong> 224.0.0.0</strong> 到<strong> 239.255.255.255</strong>。</p></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/88fba151b7a7492cac004773ffb46e5d.png" alt></p><ul><li><strong>广播的应用：ARP 数据报广播</strong></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e6504209d9fb42e1857ef6c83c399dc4.png" alt></p><p><em>注意：在进行 UDP 编程时，UDP 包的大小可以达到 64k，但实际上 MTU 大小只有 1k 多，如果直接发一个超过 MTU 大小的包，就会在网络层被分片，这样的问题是，<strong>如果只要有一个分片在传输中出错了即校验不正确（这是较容易发生的），整个传输的 udp 包就被丢弃</strong>。注意是整个而不是单个分片。这就是为什么<strong>发送 UDP 包通常也是 1k 多大小</strong>的原因。</em></p><h3 id="256-tcp和udp的区别"><a class="anchor" href="#256-tcp和udp的区别">#</a> 2.5.6 TCP 和 UDP 的区别</h3><p><strong>1、对比</strong></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/93c80a9a5be54627824624e16e7cb9ee.png" alt></p><p>除了上图所展示的区别外，使用 TCP 传输协议时，一旦建立好 TCP 连接后，系统需要实时的维护该连接，所以 TCP 所消耗的系统资源比 UDP 要多。</p><p>另外因为 TCP 的可靠性传输机制导致 TCP 传输数据时比 UDP 要慢的多。</p><p><strong>2、TCP 的长连接和短链接</strong></p><ul><li><strong>长连接</strong>：TCP 通信双方在建立好连接后，在较长一段时间内保持连接，直至某一方主动关闭连接。<strong>长连接多用于操作频繁，点对点的通讯</strong>，例如在物联网开发中某下位机需要定时地频繁向服务发送数据等。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e292fea06b494d25b2047c7e00dc1c11.png" alt></p><ul><li><strong>短链接</strong>：通信双方有数据交互时，就建立一个 TCP 连接，数据发送完成后，则断开此 TCP 连接。短连接多用于操作不频繁，点对点的通讯，例如：在 HTTP/1.0 中默认使用短连接。也就是说，客户端和服务器每进行一次 HTTP 操作，就建立一次连接，任务结束就中断连接。</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/0bf86bde31be435e9cb7b42c612c3d9d.png" alt></p><ul><li><strong>长连接短链接对比</strong></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4903fbef95704e25be821ee2de95c3bb.png" alt></p><p><strong>3、UDP 的灵活应用</strong></p><p>应用项目：高压线覆冰监测系统。</p><p>监控中心为了较快显示工业摄像头采集到的高清照片，监控子站主机需要使用 UDP 与监控中心主机进行图像数据的传输，但是因为使用了 UDP 传输协议可能会导致某些数据报丢失。为了保证图像数据的完整性，我们需要在应用层设计私有协议保障丢失的数据报能够进行重传。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/fb3fead9a30247f5b9914a48ca50e9cc.png" alt></p><h2 id="26-wireshark"><a class="anchor" href="#26-wireshark">#</a> 2.6 wireshark</h2><h3 id="261-wireshark的安装"><a class="anchor" href="#261-wireshark的安装">#</a> 2.6.1 wireshark 的安装</h3><h3 id="262-界面介绍"><a class="anchor" href="#262-界面介绍">#</a> 2.6.2 界面介绍</h3><p>1、网卡选择</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4001fb0bdca7439da87c3aeefd3d109e.png" alt></p><p>2、首页</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/78d62a5b955b4d7691d26a81a02026ee.png" alt></p><p>常用按钮从左到右的功能依次是:</p><ul><li>列出可用接口。</li><li>抓包时需要设置的一些选项。一般会保留最后一次的设置结果。</li><li>开始新的一次抓包。</li><li>暂停抓包。</li><li>继续进行本次抓包。</li><li>打开抓包文件。可以打开之前抓包保存后的文件。不仅可以打开 wireshark 软件保存的文件，也可以打开 tcpdump 使用 - w 参数保存的文件。</li><li>保存文件。把本次抓包或者分析的结果进行保存。</li><li>关闭打开的文件。文件被关闭后，就会切换到初始界面。</li><li>重载抓包文件。</li></ul><p>3、数据包列表， 显示捕获到的数据包，每个<strong>数据包编号，时间戳，源地址，目标地址，协议，长度，以及数据包信息</strong>。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/0829330f959e4355971088f7b64b4bf0.png" alt></p><p>4、数据包详细信息，在数据包列表中选择指定数据包，在数据包详细信息中会显示数据包的所有详细信息内容。数据包详细信息面板是最重要的，用来查看协议中的每一个字段。各行信息分别为</p><ul><li>Frame: 物理层的数据帧概况</li><li>Ethernet II: 数据链路层以太网帧头部信息</li><li>Internet Protocol Version 4: 互联网层 IP 包头部信息</li><li>User Datagram Protocol: 传输层的数据段头部信息，此处是 UDP</li><li>Hypertext Transfer Protocol: 应用层的信息，此处是 HTTP 协议</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/4d86bfe75dde4456889dd27aa7632f36.png" alt></p><p>5、我们可以在过滤器窗口筛选出 http 协议的相关数据包，并且查看 TCP 包的每个字段</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/42d5ab22a35545ccb31f68933ee5cf5f.png" alt></p><h3 id="263-wireshark过滤器"><a class="anchor" href="#263-wireshark过滤器">#</a> 2.6.3 wireshark 过滤器</h3><p>初学者使用 wireshark 时，将会得到大量的冗余数据包列表，以至于很难找到自己自己抓取的数据包部分。wireshar 工具中自带了两种类型的过滤器，学会使用这两种过滤器会帮助我们在大量的数据中迅速找到我们需要的信息。</p><p>1、设置数据抓取选项</p><p>点击常用按钮中的设置按钮，就会弹出设置选项对话框。在这个对话框中我们可以选中需要监听的接口，设置混杂模式，设置抓取数据包的过滤条件。如下图：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/268eb63f45e34aa7a35926810948175a.png" alt></p><p>首先，选中需要监听获取数据包的接口。接口列表区列出了所有可以使用的接口。如果接口前面的复选框被选中，说明对这个接口监听捕获数据包。</p><p>其次，设置混杂模式。设置混杂模式的作用是将网卡设置到混杂模式。如果不设置混杂模式，你的计算机只能获取数据包发往的目标是你计算机和从你计算机出去的数据包。如果设置了混杂模式，你就可以捕获局域网中所有的数据包。如果窗口中的 &quot;Use promiscuous mode on all interfaces&quot; 前面的复选框被选中，说明对所有的接口使用混杂模式。如果想单独设置，可以双击接口列表中的接口，会弹出如下的对话框。然后选中或者去掉 “Capture packets in promiscuous mode” 前面复选框。然后点 ok 按钮。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/befe6e30292e42baadefb2872733c70c.png" alt></p><p>2、显示过滤器</p><p>显示过滤器应用于捕获文件，用来告诉 wireshark 只显示那些符合过滤条件的数据包。显示过滤器比捕获过滤器更常用。他可以用来过滤不想看到的数据包，但是不会把数据删除。如果想恢复原状，只要把过滤条件删除即可。</p><p>过滤器表达式对话框，是的 wireshark 的可以很简单的设置过滤表达式。点击 “Expression” 按钮就可以打开这个对话框。如下图：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ea64bb7d09ab4d709a7c86f12a3bbef1.png" alt></p><p>对话框分左中右三部分。左边为可以使用的所有协议域（过滤项）。右边为和协议域相关的条件值（过滤值）。中间为协议域与条件值之间的关系（过滤关系）。</p><p><strong>一条基本的表达式由过滤项、过滤关系、过滤值三项组成。</strong></p><p>比如：http contains <span class="exturl" data-url="aHR0cDovL2JhaWR1LmNvbQ==">baidu.com</span>， http 为过滤项， contains 为过滤关系， <span class="exturl" data-url="aHR0cDovL2JhaWR1LmNvbQ==">baidu.com</span> 为过滤值，表示显示 http 协议包中包含关键词 “<span class="exturl" data-url="aHR0cDovL2JhaWR1LmNvbQ==">baidu.com</span>” 的所有数据包</p><p>比如：ip.addr == 192.168.1.1，ip.addr 是过滤项、== 是过滤关系，192.168.1.1 是过滤值（整条表达示的意思是找出所有 ip 协议中源或目标 ip、等于、192.168.1.1 的数据包）</p><p>3、过滤关系</p><p>过滤关系就是大于、小于、等于等几种等式关系，我们可以直接看官方表格，注意其中有 “English” 和 “C-like” 两个字段，这个意思是说 “English” 和 “C-like” 这两种写法在 wireshark 中是等价的、都是可用的。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/54b76760203a462eb1e34d0454b35a84.png" alt></p><p>4、复合过滤表达式</p><p>所谓复合过滤表达式，就是指由多条基本过滤表达式组合而成的表达示。基本过滤表达式的写法还是不变的，复合过滤表达示多出来的东西就只是基本过滤表达示的 “连接词”。我们依然直接参照官方表格，同样 “English” 和 “C-like” 这两个字段还是说明这两种写法在 wireshark 中是等价的、都是可用的。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2f027749692147d693f0fcbcc7cdaaea.png" alt></p><p>5、执行 ping www.baidu.com 获取的数据包列表如下</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b2d1eb7761194ed4a1930c8774158ff4.png" alt></p><p>观察上述获取的数据包列表，含有大量的无效数据。这时可以通过设置显示器过滤条件进行提取分析信息。ip.addr == 14.215.177.39 and icmp。并进行过滤</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/94fcd57091f444a69588010c49664464.png" alt></p><p>6、常见用显示过滤需求及其对应表达式</p><ul><li>数据链路层：<ul><li>筛选 mac 地址为 04:f9:38:ad:13:26 的数据包：eth.src == 04:f9:38:ad:13:26</li><li>筛选源 mac 地址为 04:f9:38:ad:13:26 的数据包：eth.src == 04:f9:38:ad:13:26</li></ul></li><li>网络层：<ul><li>筛选 ip 地址为 192.168.1.1 的数据包：ip.addr == 192.168.1.1</li><li>筛选 192.168.1.0 网段的数据： ip contains 192.168.1</li><li>筛选 192.168.1.1 和 192.168.1.2 之间的数据包：ip.addr == 192.168.1.1 &amp;&amp; ip.addr == 192.168.1.2</li><li>筛选从 192.168.1.1 到 192.168.1.2 的数据包：ip.src == 192.168.1.1 &amp;&amp; ip.dst == 192.168.1.2</li></ul></li><li>传输层：<ul><li>筛选 tcp 协议的数据包：tcp</li><li>筛选除 tcp 协议以外的数据包:!tcp</li><li>筛选端口为 80 的数据包：tcp.port == 80</li><li>筛选 12345 端口和 80 端口之间的数据包：tcp.port == 12345 &amp;&amp; tcp.port == 80</li><li>筛选从 12345 端口到 80 端口的数据包：tcp.srcport == 12345 &amp;&amp; tcp.dstport == 80</li></ul></li><li>应用层：<ul><li>特别说明：http 中 http.request 表示请求头中的第一行（如 GET index.jsp HTTP/1.1），http.response 表示响应头中的第一行（如 HTTP/1.1 200 OK），其他头部都用 http.header_name 形式。</li><li>筛选 url 中包含.php 的 http 数据包：http.request.uri contains .php</li><li>筛选内容包含 username 的 http 数据包：http contains username</li></ul></li></ul><h3 id="264-使用wireshark分析tcp三次握手"><a class="anchor" href="#264-使用wireshark分析tcp三次握手">#</a> 2.6.4 使用 wireshark 分析 TCP 三次握手</h3><p>1、设置过滤阿里云服务器的 IP 地址：ip.addr == 47.104.157.132</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b7c664d6338649098284a98908783c98.png" alt></p><p>2、使用 TCP 调试助手连接阿里云服务器上的 TCP 服务端</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/fd1c7d64af7d407799ed2339fbe7ab49.png" alt></p><p>3、我们发现 wireshark 捕获到了 3 条 TCP 数据</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/09e2e3539d5e424b8e7ffe5d0c52c0c9.png" alt></p><ul><li><p>第一次握手数据包：客户端发送一个 TCP，标志位为 SYN，序列号为 0， 代表客户端请求建立连接。 如下图<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/f05cbda06fef4912ba80f523934cef5d.png" alt></p></li><li><p>第二次握手：服务器发回确认包，标志位为 SYN,ACK. 将确认序号 (Acknowledgement Number) 设置为客户的 seq 加 1 以。即 0+1=1, 如下图<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/8d508b7d4b5742a4bffd1a487f9f3c99.png" alt></p></li><li><p>第三次握手：客户端再次发送确认包 (ACK) SYN 标志位为 0,ACK 标志位为 1，如下图:<br><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b65a00d813384854b74dbcfd06591530.png" alt></p><h3 id="265-使用wireshark分析tcp数据包"><a class="anchor" href="#265-使用wireshark分析tcp数据包">#</a> 2.6.5 使用 wireshark 分析 TCP 数据包</h3><p>1、使用 tcp 调试助手向阿里云服务器 TCP 服务端发送 hello，并且接收到服务器返回的 hello world</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2a1752dfcc634809a6dddea92fd4f825.png" alt></p><p>2、我们发现 wireshark 捕获到了四条 TCP 数据</p></li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/a30ebf8f5f024c239be17c87eb3546c8.png" alt></p><h2 id="27-应用层"><a class="anchor" href="#27-应用层">#</a> 2.7 应用层</h2><h3 id="271-应用层概述"><a class="anchor" href="#271-应用层概述">#</a> 2.7.1 应用层概述</h3><p>应用层是网络体系结构中的最上层，所有的网络应用程序和服务都工作在应用层。</p><p>常见的网络应用程序：浏览器、手游、即时通信软件、网站的后台程序、网游的主程等。</p><p>常见的网络服务：telnet、FTP、ssh 等。</p><h3 id="272-万维网"><a class="anchor" href="#272-万维网">#</a> 2.7.2 万维网</h3><p><strong>1、万维网概述</strong></p><p>万维网 WWW (World Wide Web）<strong>并非某种特殊的计算机网络</strong>。它是一个大规模的、联机式的信息储藏所，是<strong>运行在因特网上的一个分布式应用</strong>。</p><p>万维网利用网页之间的<strong>超链接</strong>将不同网站的网页链接成一张逻辑上的信息网。</p><p>万维网是欧洲粒子物理实验室的 Tim Berners-Lee（蒂姆伯纳斯李）最初于 1989 年 3 月提出的。</p><p>1993 年 2 月，第一个图形界面的浏览器 Mosaic 诞生，1995 年著名的 Netscape Navigator（网景）浏览器上市</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/43c5f0b677764b4aa55a8d4ccd4e40b0.png" alt></p><p>目前流行的浏览器有以下几种：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/9ffb41cc2c8246b89e6ddd844ba5f393.png" alt></p><p><strong>2、统一资源定位符 URL</strong></p><p>当我们访问某个网页时，在浏览器的地址栏会出现一长串的字符，这一长串的字符我们称之为统一资源定位符 URL。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/f78235aec8134c2bb960ba53b9e37178.png" alt></p><p>我们所访问到的网页上的内容其实是服务器上的某个资源，每个资源在服务器上都对应着一个位置。</p><p>万维网使用<strong>统一资源定位符 URL</strong> 来指明因特网上任何种类 “资源” 的位置。</p><p>URL 的一般形式由以下四个部分组成：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/abc1d66f48ab4c4695a703d09d7a8a58.png" alt></p><p>我们可以将某个网页另存为文件，存储后有一个 html 文件和一个文件夹。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/51b0b5db0f464c28990900488f9f65d0.png" alt></p><p>文件夹中的内容如下：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/2b6acd8795724ee98b0af83703121780.png" alt></p><p><strong>万维网文档：由 HTMLCSS、JavaSaript 编写的方维网文档</strong></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ea02ee0104a14f7ead63a55ce66cad07.png" alt></p><h3 id="273-http协议"><a class="anchor" href="#273-http协议">#</a> 2.7.3 HTTP 协议</h3><p><strong>1、浏览器发送 HTTP 请求的过程</strong></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/13fae9cba081494caaa7d59928080de3.png" alt></p><p><strong>2、HTTP 协议概述</strong><br><strong>超文本传输协议 HTTP</strong> (HyperText Transfer Protocol) 定义了浏览器 (即万维网客户进程) 怎样向万维网服务器请求万维网文档，以及万维网服务器怎样把万维网文档传送给浏览器。是处理<strong>客户端</strong>和<strong>服务端</strong>之间的通信</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/5003fb85a70246428ce470f46e266a00.png" alt></p><p><strong>3、HTTP/1.0</strong><br>HTTP/1.0 采用<strong>非持续连接</strong>方式。在该方式下，每次浏览器要请求一个文件都要与服务器建立 TCP 连接，当收到响应后就立即关闭连接。每请求一个文档就要有两倍的 RTT 的开销。若一个网页上有很多引用对象（例如图片等)<br>那么请求每一个对象都需要花费 2RTT 的时间。</p><p>为了减小时延，浏览器通常会建立多个并行的 TCP 连接同时请求多个对象。但是，这会大量占用万维网服务器的资源，特别是万维网服务器往往要同时服务于大量客户的请求，这会使其负担很重。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/d33e35b5176645018a4328e80c931235.png" alt></p><p><strong>4、HTTP/1.1</strong><br>HTTP/1.1 采用<strong>持续连接</strong>方式。在该方式下，万维网服务器在发送响应后仍然保持这条连接，使同一个客户（浏览器）和该服务器可以继续在这条连接上传送后续的 HTTP 请求报文和响应报文。这并不局限于传送同一个页面上引用的对象，而是只要这些文档都在同一个服务器上就行。</p><p>为了进一步提高效率，HTTP/1.1 的持续连接还可以使用<strong>流水线方式工作</strong>，即浏览器在收到 HTTP 的响应报文之前就能够连续发送多个请求报文。这样的一个接一个的请求报文到达服务器后，服务器就发回一个接一个的响应报文。这样就节省了很多个 RTT 时间，使 TCP 连接中的空闲时间减少，提高了下载文档的效率。</p><p><strong>5、HTTP 报文格式</strong></p><p>HTTP 是面向文本的，其报文中的每一个字段都是一些 ASCII 码串，并且每个字段的长度都是不确定的。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c0a52c946ffd4bc4a743795acf13c968.png" alt></p><p>我们可以利用浏览器的开发者工具查看某个 HTTP 请求的报文：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/d1cd6c9ab6074cd7ae75a504ee314e26.png" alt></p><p><strong>HTTP 协议支持的请求方法：</strong></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/987a8c10209e448d987e27db4ee881f2.png" alt></p><p><strong>HTTP 常见的请求头：</strong></p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/78f94636dec64a4f9e2dafafc9491f86.png" alt></p><p><strong>Connection</strong>：决定 HTTP 连接（不是 TCP 连接）是否在当前事务完成后关闭。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/6fa9992f40ea4c13996185a80be22f7f.png" alt></p><p><em>Keep-Alive：多次请求复用一个 TCP 连接。</em></p><p><em>Keep-Alive: timeout=5, max=1000</em></p><p><strong>User-Agent</strong>：这个字段可以帮助统计客户端用了什么浏览器、操作系统等</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b28437c21cf54864a7120b6361a9785f.png" alt></p><p><strong>Content-Type</strong>：请求的时候，告知服务端数据的媒体类（MediaType/MIME Type)。返回的时候告知客户端，数据的媒体类型。</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/e2ae87d81c394c879e3fc6520bdccac4.png" alt></p><p><strong>Cookie</strong>：Cookie 提供了一种机制使得万维网服务器能够 “记住” 用户，而无需用户主动提供用户标识信息。也就是说，<strong>Cookie 是一种对无状态的 HTTP 进行状态化的技术</strong>。</p><p><em>HTTP 是无状态的：协议对于事务处理没有记忆能力，对同一个 url 请求没有上下文关系，每次的请求都是独立的，它的执行情况和结果与前面的请求和之后的请求是无直接关系的，它不会受前面的请求应答情况直接影响，也不会直接影响后面的请求应答情况</em></p><p>使用 Cookie 在服务器上记录用户信息：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/ce270ff6dc2f4630a6febca90bbc79cd.png" alt></p><p><strong>状态码</strong>：web 服务器告诉客户端请求的状态</p><p>常见的状态码为以下四类：</p><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/08d4d95a41694a57b0eb58dc527fd117.png" alt></p><ul><li>200 状态码</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/b1c7dc6d095946f2ae4349e86667950f.png" alt></p><ul><li>3xx 状态码</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/9544b1ec1c46464fa419a8fd96e10a91.png" alt></p><ul><li>4xx 状态码</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/27b5808f632f4fea87bf5538edbbec37.png" alt></p><ul><li>5xx 状态码</li></ul><p><img data-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/402/1637632193000/c8db49c7712045acaec1281b767e67d4.png" alt></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-11-27 13:42:15" itemprop="dateModified" datetime="2022-11-27T13:42:15+08:00">2022-11-27</time> </span><span id="2022/11/25/计算机网络体系结构/" class="item leancloud_visitors" data-flag-title="计算机网络体系结构" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Mang Pumo 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Mang Pumo 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Mang Pumo <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://mangpumo.github.io/2022/11/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" title="计算机网络体系结构">https://mangpumo.github.io/2022/11/25/计算机网络体系结构/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/11/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipetv6p75j20zk0m8x6p.jpg" title="计算机网络概述"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>计算机网络概述</h3></a></div><div class="item right"><a href="/2022/11/26/XTUOJ-1271Color/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipexj2jgzj20zk0m8b09.jpg" title="XTUOJ_1271Color"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>XTUOJ_1271Color</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">计算机网络体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E5%B8%B8%E7%94%A8%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">2.1 常用的计算机网络体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#211-osi%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.1.</span> <span class="toc-text">2.1.1 OSI 体系结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#212%E5%85%B7%E6%9C%89%E4%BA%94%E5%B1%82%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.1.2 具有五层协议的体系结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E7%89%A9%E7%90%86%E5%B1%82"><span class="toc-number">1.2.</span> <span class="toc-text">2.2 物理层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#221-%E7%89%A9%E7%90%86%E5%B1%82%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.2.1 物理层的基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#222-%E4%BC%A0%E8%BE%93%E5%AA%92%E4%BD%93"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2.2 传输媒体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82"><span class="toc-number">1.3.</span> <span class="toc-text">2.3 数据链路层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#231-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">2.3.1 数据链路层概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#232-%E5%B0%81%E8%A3%85%E6%88%90%E5%B8%A7"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.3.2 封装成帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#233-%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93"><span class="toc-number">1.3.3.</span> <span class="toc-text">2.3.3 透明传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#234-%E5%B7%AE%E9%94%99%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.3.4.</span> <span class="toc-text">2.3.4 差错校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#234-%E4%BB%A5%E5%A4%AA%E7%BD%91"><span class="toc-number">1.3.5.</span> <span class="toc-text">2.3.4 以太网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#235-%E4%BB%A5%E5%A4%AA%E7%BD%91%E7%9A%84mac%E5%B1%82"><span class="toc-number">1.3.6.</span> <span class="toc-text">2.3.5 以太网的 MAC 层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">1.3.7.</span> <span class="toc-text">以太网交换机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#237-%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91vlan"><span class="toc-number">1.3.8.</span> <span class="toc-text">2.3.7 虚拟局域网 VLAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#238-%E5%8D%8E%E4%B8%BAensp-vlan%E5%AE%9E%E9%AA%8C"><span class="toc-number">1.3.9.</span> <span class="toc-text">2.3.8 华为 eNSP VLAN 实验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.4.</span> <span class="toc-text">2.4 网络层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#241-%E7%BD%91%E7%BB%9C%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.4.1.</span> <span class="toc-text">2.4.1 网络层概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#242-ipv4%E5%9C%B0%E5%9D%80%E6%A6%82%E8%BF%B0"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.4.2 IPv4 地址概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#243-ipv4-%E5%9C%B0%E5%9D%80%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.3.</span> <span class="toc-text">2.4.3 IPv4 地址的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#244-%E5%AD%90%E7%BD%91%E7%9A%84%E5%88%92%E5%88%86"><span class="toc-number">1.4.4.</span> <span class="toc-text">2.4.4 子网的划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#245-ip-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.5.</span> <span class="toc-text">2.4.5 IP 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#246-ip%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E5%8F%91%E9%80%81%E5%92%8C%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.6.</span> <span class="toc-text">2.4.6 IP 数据报的发送和转发过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#247-%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">1.4.7.</span> <span class="toc-text">2.4.7 路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#248-arp%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E8%A1%A8"><span class="toc-number">1.4.8.</span> <span class="toc-text">2.4.8 ARP 高速缓存表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#249-%E7%89%B9%E6%AE%8Aip%E5%9C%B0%E5%9D%80"><span class="toc-number">1.4.9.</span> <span class="toc-text">2.4.9 特殊 IP 地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E8%BF%90%E8%BE%93%E5%B1%82"><span class="toc-number">1.5.</span> <span class="toc-text">2.5 运输层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#251-%E8%BF%90%E8%BE%93%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">2.5.1 运输层概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#252-%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.5.2 端口号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#253-%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AEtcp"><span class="toc-number">1.5.3.</span> <span class="toc-text">2.5.3 传输控制协议 TCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#254-tcp%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.4.</span> <span class="toc-text">2.5.4 TCP 可靠传输的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#255-%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AEudp"><span class="toc-number">1.5.5.</span> <span class="toc-text">2.5.5 用户数据报协议 UDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#256-tcp%E5%92%8Cudp%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.6.</span> <span class="toc-text">2.5.6 TCP 和 UDP 的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-wireshark"><span class="toc-number">1.6.</span> <span class="toc-text">2.6 wireshark</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#261-wireshark%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">1.6.1.</span> <span class="toc-text">2.6.1 wireshark 的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#262-%E7%95%8C%E9%9D%A2%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.2.</span> <span class="toc-text">2.6.2 界面介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#263-wireshark%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">2.6.3 wireshark 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#264-%E4%BD%BF%E7%94%A8wireshark%E5%88%86%E6%9E%90tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="toc-number">1.6.4.</span> <span class="toc-text">2.6.4 使用 wireshark 分析 TCP 三次握手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#265-%E4%BD%BF%E7%94%A8wireshark%E5%88%86%E6%9E%90tcp%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">1.6.5.</span> <span class="toc-text">2.6.5 使用 wireshark 分析 TCP 数据包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E5%BA%94%E7%94%A8%E5%B1%82"><span class="toc-number">1.7.</span> <span class="toc-text">2.7 应用层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#271-%E5%BA%94%E7%94%A8%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.7.1.</span> <span class="toc-text">2.7.1 应用层概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#272-%E4%B8%87%E7%BB%B4%E7%BD%91"><span class="toc-number">1.7.2.</span> <span class="toc-text">2.7.2 万维网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#273-http%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.7.3.</span> <span class="toc-text">2.7.3 HTTP 协议</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Mang Pumo" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Mang Pumo</p><div class="description" itemprop="description">欢迎来到 Mang Pumo 的个人博客!</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">168</span> <span class="name">文章</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/11/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/11/26/XTUOJ-1271Color/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/07/XTUOJ-1217A-BVII/" title="XTUOJ_1217A+BVII">XTUOJ_1217A+BVII</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/10/28/XTUOJ-1148%E4%B8%89%E8%A7%92%E5%BD%A2/" title="XTUOJ_1148三角形">XTUOJ_1148三角形</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/27/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F/" title="SQL注入之查询方式">SQL注入之查询方式</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/14/SQL%E6%B3%A8%E5%85%A5%E4%B9%8Bsqli-labs%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="SQL注入之sqli-labs环境搭建">SQL注入之sqli-labs环境搭建</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/01/11/AppScan%E6%89%AB%E6%8F%8F%E6%8A%A5%E5%91%8A/" title="AppScan扫描报告">AppScan扫描报告</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/15/SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E9%AB%98%E6%9D%83%E9%99%90%E6%B3%A8%E5%85%A5%E4%B8%8B/" title="SQL注入之高权限注入下">SQL注入之高权限注入下</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/10/CTF-Web-SQL%E6%B3%A8%E5%85%A5/" title="CTF_Web_SQL注入">CTF_Web_SQL注入</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/08/%E6%95%B0%E7%BB%84%E7%AE%97%E6%B3%95%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0ING%EF%BC%89/" title="数组算法（持续更新ING）">数组算法（持续更新ING）</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/08/%E6%95%B0%E7%BB%84-%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/" title="数组_移除元素">数组_移除元素</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/27/SQL%E6%B3%A8%E5%85%A5%E4%B9%8Bsqlmap%E4%BD%BF%E7%94%A8-post%E6%B3%A8%E5%85%A5/" title="SQL注入之sqlmap使用-post注入">SQL注入之sqlmap使用-post注入</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Mang Pumo @ Mang Pumo</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">254k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">3:51</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div>script type="text/javascript" src="/js/mouseline.js"</div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/11/25/计算机网络体系结构/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>